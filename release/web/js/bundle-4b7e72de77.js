!function(){"use strict";var e,t;function __decorate(e,t,i,a){var s,n=arguments.length,o=n<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,a);else for(var d=e.length-1;d>=0;d--)(s=e[d])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o}function __metadata(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function __awaiter(e,t,i,a){return new(i||(i=Promise))(function(s,n){function fulfilled(e){try{step(a.next(e))}catch(e){n(e)}}function rejected(e){try{step(a.throw(e))}catch(e){n(e)}}function step(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(fulfilled,rejected)}step((a=a.apply(e,t||[])).next())})}!function(e){e.AboutView="scenes/views/AboutView.scene",e.AddLandView="scenes/views/AddLandView.scene",e.BuyVitalityView="scenes/views/BuyVitalityView.scene",e.FieldLevelUpView="scenes/views/FieldLevelUpView.scene",e.FriendsDescView="scenes/views/FriendsDescView.scene",e.FriendsRewardView="scenes/views/FriendsRewardView.scene",e.FriendsView="scenes/views/FriendsView.scene",e.GatherDescView="scenes/views/GatherDescView.scene",e.HintView="scenes/views/HintView.scene",e.LoginView="scenes/views/LoginView.scene",e.MailDescView="scenes/views/MailDescView.scene",e.MailView="scenes/views/MailView.scene",e.MainView="scenes/views/MainView.scene",e.OrderView="scenes/views/OrderView.scene",e.OverView="scenes/views/OverView.scene",e.SettingView="scenes/views/SettingView.scene",e.ShopView="scenes/views/ShopView.scene",e.SignInDescView="scenes/views/SignInDescView.scene",e.SignInView="scenes/views/SignInView.scene",e.SpeedUpView="scenes/views/SpeedUpView.scene",e.TaskView="scenes/views/TaskView.scene",e.WarehouseView="scenes/views/WarehouseView.scene",e.WithdrawRecordView="scenes/views/WithdrawRecordView.scene"}(e||(e={})),function(e){e.zhongzhi="res/audio/zhongzhi.mp3",e.tudishengji="res/audio/tudishengji.mp3",e.shoucai="res/audio/shoucai.mp3",e.goujiaosheng="res/audio/goujiaosheng.mp3",e.dakaicangku="res/audio/dakaicangku.mp3",e.button_click="res/audio/button_click.mp3",e.BGM="res/audio/BGM.mp3"}(t||(t={}));const i={views:e,scenes:["scenes/views/WithdrawRecordView.scene","scenes/views/WarehouseView.scene","scenes/views/TaskView.scene","scenes/views/SpeedUpView.scene","scenes/views/SignInView.scene","scenes/views/SignInDescView.scene","scenes/views/ShopView.scene","scenes/views/SettingView.scene","scenes/views/OverView.scene","scenes/views/OrderView.scene","scenes/views/MainView.scene","scenes/views/MailView.scene","scenes/views/MailDescView.scene","scenes/views/LoginView.scene","scenes/views/HintView.scene","scenes/views/GatherDescView.scene","scenes/views/FriendsView.scene","scenes/views/FriendsRewardView.scene","scenes/views/FriendsDescView.scene","scenes/views/FieldLevelUpView.scene","scenes/views/BuyVitalityView.scene","scenes/views/AddLandView.scene","scenes/views/AboutView.scene","scenes/prefab/MailItem.prefab","scenes/prefab/GetReward.prefab","scenes/prefab/FloatRewardIcon.prefab","scenes/prefab/FieldPrefab.prefab","scenes/components/Button.prefab","scenes/ani/landUp.ani","res/loadingBg.png","res/img_woodtitle.png","res/img_storeHouseBg.png","res/img_storebg.png","res/img_shelf.png","res/img_popUpBgMain.png","res/img_popUpBg.png","res/img_landBg.png","res/img_inviteBg1.png","res/img_housetop.png","res/img_hongbaoban.png","res/img_homepageBg3.png","res/img_homepageBg2.png","res/img_homepageBg1.png","res/img_farmlandLogo.png","res/figure5.png","res/figure5.atlas","res/figure4.png","res/figure4.atlas","res/figure3.png","res/figure3.atlas","res/figure2.png","res/figure2.atlas","res/figure1.png","res/figure1.atlas","res/figure.png","res/figure.atlas","res/dog_1010.png","res/dog_1010.atlas","res/dog_1009.png","res/dog_1009.atlas","res/dog_1008.png","res/dog_1008.atlas","res/dog_1007.png","res/dog_1007.atlas","res/dog_1006.png","res/dog_1006.atlas","res/dog_1005.png","res/dog_1005.atlas","res/dog_1004.png","res/dog_1004.atlas","res/dog_1003.png","res/dog_1003.atlas","res/dog_1002.png","res/dog_1002.atlas","res/dog_1001.png","res/dog_1001.atlas","res/shader/vs.vs","res/shader/ps.fs","res/audio/zhongzhi.mp3","res/audio/tudishengji.mp3","res/audio/shoucai.mp3","res/audio/goujiaosheng.mp3","res/audio/dakaicangku.mp3","res/audio/button_click.mp3","res/audio/BGM.mp3","res/atlas/plant_icon.png","res/atlas/plant_icon.atlas","res/atlas/pet_feed.png","res/atlas/pet_feed.atlas","res/atlas/main_scene.png","res/atlas/main_scene.atlas","res/atlas/load.png","res/atlas/load.atlas","res/atlas/game.png","res/atlas/game.atlas"],audios:t},a=new Laya.EventDispatcher,s=new Map;const n=new Map;const o=new Map;var d=new class{constructor(){this.keyEvents=new Map}watch(e,t){o.has(t)||o.set(t,[]);let i=this.keyEvents;i.has(e)||i.set(e,new Map);const a=(s,n)=>{let d=i.get(e);return d.has(s)||(d.set(s,[]),null==e["#"+s]&&(e["#"+s]=e[s],Object.defineProperty(e,s,{configurable:!1,enumerable:!1,set:function(e){this["#"+s]=e,d.get(s).forEach(t=>{t(e)})},get:function(){return this["#"+s]}}))),d.get(s).push(n),o.get(t).push(n),n(e[s]),{key:a}};return{key:a}}removeByCaller(e,t=null){var i;null===(i=o.get(e))||void 0===i||i.forEach(e=>{var i,a;t?null===(i=this.keyEvents)||void 0===i||i.get(t).forEach(t=>{let i=t.indexOf(e);i>-1&&t.splice(i,1)}):null===(a=this.keyEvents)||void 0===a||a.forEach(t=>{t.forEach(t=>{let i=t.indexOf(e);i>-1&&t.splice(i,1)})})})}};class l extends Laya.Script{constructor(){super();let e=s.get(this.constructor.prototype);null==e||e.forEach(e=>{a.on(e.key,this,e.fn)})}onAwake(){var e;null===(e=n.get(this.constructor.prototype))||void 0===e||e.forEach(e=>{this[e]=this.owner.getChildByName(e)}),this.onHdAwake()}onOpened(e){}onHdAwake(){}onEnable(){this.onHdEnable()}onHdEnable(){}onStart(){this.onHdStart()}onHdStart(){}onUpdate(){this.onHdUpdate()}onHdUpdate(){}onDisable(){this.onHdDisable()}onHdDisable(){}onDestroy(){a.offAllCaller(this),this.onHdDestroy(),Laya.timer.once(1,null,()=>{d.removeByCaller(this);let e=Object.getOwnPropertyNames(this);for(let t=0,i=e.length;t<i;t++)this[e[t]]=null})}onHdDestroy(){}}class r extends l{constructor(){super(...arguments),this.bg=null,this.content=null,this.tweenList=[]}doOpen(){}doClose(){}onEnable(){let e=this.owner;switch(this.bg.alpha=0,this.tweenList.push(Laya.Tween.to(this.bg,{alpha:.75},100,null,Laya.Handler.create(this,this.doOpen,[e]),0,!1,!1)),this.aniType){case"scaleShow":this.content.scale(1,1),this.tweenList.push(Laya.Tween.from(this.content,{x:Laya.stage.width/2,y:Laya.stage.height/2,scaleX:0,scaleY:0},300,Laya.Ease.backOut,Laya.Handler.create(this,this.doOpen,[e]),0,!1,!1));break;default:this.content.bottom=-this.content.height,this.tweenList.push(Laya.Tween.to(this.content,{bottom:0},300,Laya.Ease.circOut,Laya.Handler.create(this,this.doOpen,[e]),0,!1,!1))}}closeView(){let e=this.owner;return new Promise(t=>{switch(this.tweenList.push(Laya.Tween.to(this.bg,{alpha:0},200,null,Laya.Handler.create(this,this.doOpen,[e]),0,!1,!1)),this.aniType){case"scaleShow":this.tweenList.push(Laya.Tween.to(this.content,{x:Laya.stage.width/2,y:Laya.stage.height/2,scaleX:.5,scaleY:.5,alpha:0},150,null,new Laya.Handler(this,()=>{this.doClose(),t(null)},[e]),0,!1,!1));break;default:this.tweenList.push(Laya.Tween.to(this.content,{bottom:-this.content.height},200,null,new Laya.Handler(this,()=>{this.doClose(),t(null)},[e]),0,!1,!1))}})}onDisable(){this.tweenList.forEach(e=>{Laya.Tween.clear(e)}),this.tweenList.length=0}}const c=new Map;let h=100;function Instance(e,t){c.has(e["#instanceId"])||(h++,e["#instanceId"]=h,c.set(h,new e)),e[t]=c.get(h)}const u=[];class p{loginOut(){u.forEach(e=>{e.view.getComponents(Laya.Script).forEach(e=>{Laya.timer.clearAll(e),e.destroy()}),this.closeViewLog(e.view.url,!0),e.view.destroy(!0)}),u.length=0}open(e,t={closeOther:!1,showLoad:!1,showLoadDelay:100,hideLoadDelay:0}){e?(t.showLoad&&(Laya.View.showLoadingPage(null,t.showLoadDelay),e!==i.views.LoginView&&Laya.timer.frameOnce(1,this,()=>{Laya.View.hideLoadingPage(t.hideLoadDelay)})),t.closeOther=!1,Laya.View.open(e,t.closeOther,t.parm,Laya.Handler.create(this,a=>{e!=i.views.LoginView&&u.push({url:e,view:a});let s=a.getComponents(Laya.Script);s&&s.forEach(e=>e.enabled&&e.onOpened&&e.onOpened(t.parm)),t.complete&&t.complete(a),console.log(`%c ==> open %c${e.match(/\w+(?=\.)/)[0]} `,"color:#7ed6df;font-weight:700;background-color:#dff9fb","color:#22a6b3;font-weight:700;background-color:#dff9fb")}),t.progress)):console.warn("miss path!")}close(e,t=!1,a=!1,s=r){return __awaiter(this,void 0,void 0,function*(){let a;!0;for(let n=u.length-1;n>-1;n--)if(e===u[n].url){let o=u[n];if(u.splice(n,1),(a=o.view.getComponent(s))?a.closeView().then(()=>{o.view.destroy(!0),this.closeViewLog(e,!0)}):(o.view.destroy(!0),this.closeViewLog(e,!0)),e===i.views.HintView)return;if(!t)break}if(!u.length)return;let n=0;for(let e=u.length-1;e>-1;e--)u[e].view.parent||n++;n===u.length&&(u.length=0,this.open(i.views.MainView)),console.log(u)})}closeViewLog(e,t=!1){console.log(`%c <== ${t?"destroy":"disable"} %c${e.match(/\w+(?=\.)/)[0]} `,"color:#ff7979;font-weight:700;background-color:#dff9fb","color:#eb4d4b;font-weight:700;background-color:#dff9fb")}openHint(e){this.open(i.views.HintView,{parm:e})}clearViewMaps(){u.length=0}setOverView(e,t){e?this.open(i.views.OverView,{parm:{call:e=>{this.overViewCom=e,e.close(t)}}}):this.overViewCom&&this.overViewCom.open(t)}}__decorate([Instance,__metadata("design:type",p)],p,"inst",void 0),console.log(BUILD_TYPE);let m="http://game-s.ahd168.com/farm/dev";switch(BUILD_TYPE){case"debug":m="//192.168.101.6:3000";break;case"online":m="http://game-s.ahd168.com/farm/release"}var g={diamondId:1001,goldId:1002,petDigestIntervalTime:216e3,localKey:"love_HD_farm",userVitalityLimit:10,baseUrl:m,ApiTypeDefault:1,ApiTypeAD:2,ADSpeedUpTimes:6,version:"1.0.0",channel:""};const v=new Map;class w{static runAppFunction(e){return new Promise((t,i)=>{Laya.Browser.onIOS?window.webRequest?(window.webRequest.postMessage(JSON.stringify(e)),e.timestamp&&v.set(e.timestamp,t)):t(null):window.$App&&window.$App.webRequest?(window.$App.webRequest(JSON.stringify(e)),e.timestamp&&v.set(e.timestamp,t)):t(null)})}static listenAppFunction(){window.appResponse=(e=>{v.has(null==e?void 0:e.timestamp)&&v.get(e.timestamp)(e),console.log(e)})}}w.typeIos=1,w.typeAndroid=2;const y={observableProperty:d,view:p.inst,gameScript:l,instance:Instance,eventOn:function(e){return(t,i,a)=>{s.get(t)||s.set(t,[]),s.get(t).push({key:e,fn:a.value})}},findByName:function(e,t){n.has(e)||n.set(e,[]),n.get(e).push(t)},eventGlobal:a,audio:new class{playSound(e,t,i,a,s){Laya.SoundManager.playSound(e,t,i,a,s)}playMusic(e,t=0,i,a){Laya.SoundManager.playMusic(e,t,i,a)}set soundMuted(e){Laya.SoundManager.soundMuted=e}get soundMuted(){return Laya.SoundManager.soundMuted}set musicMuted(e){Laya.SoundManager.musicMuted=e}get musicMuted(){return Laya.SoundManager.musicMuted}}};class b extends y.gameScript{constructor(){super(...arguments),this.version=null,this.channel=null}onOpened(){this.version.text=`版本号：V${g.version}`,this.channel.text=`渠道号：${g.channel}`}onClick(e){switch(e.target.name){case"close":y.view.close(i.views.AboutView);break;case"user_agreement":w.runAppFunction({uri:"serviceAgreement",data:{}});break;case"privacy":w.runAppFunction({uri:"privacyAgreement",data:{}})}}}class _ extends Laya.Script{constructor(){super(...arguments),this.isScale=!1,this.scaleVal=.9}onEnable(){this.owner.mouseEnabled=!0,this.oldScaleX=this.owner.get_scaleX(),this.oldScaleY=this.owner.get_scaleY()}onClick(){y.audio.playSound(i.audios.button_click)}onMouseDown(){this.setSkin(this.downRes),this.setAni(this.scaleVal)}onMouseOut(){this.setSkin(this.defaultRes),this.setAni(1)}onMouseUp(){this.setSkin(this.defaultRes),this.setAni(1)}setAni(e){this.isScale&&Laya.Tween.to(this.owner,{scaleX:e*this.oldScaleX,scaleY:e*this.oldScaleY},300,Laya.Ease.backOut,null,0,!1,!1)}setSkin(e){e&&(this.owner.skin=e)}onDisable(){}}const L={isLogin:!1,token:null,sound:!1,music:!1,version:"0.0.0"};var f=new class{constructor(){this.localData=L}init(){this.localData=Laya.LocalStorage.getJSON(g.localKey)||L}getJSON(){return this.localData}setJSON(e,t){this.localData[e]=t,Laya.LocalStorage.setJSON(g.localKey,this.localData)}clear(){Laya.LocalStorage.setJSON(g.localKey,{version:this.localData.version}),this.localData={isLogin:!1,token:null,sound:!0,music:!0,version:this.localData.version}}};const x={task:[{id:1001,reward:"1001:50",times:1,title:"签到领钻石",desc:"看视频签到",icon:null},{id:1002,reward:"1001:100",times:10,title:"菜地施肥10次",desc:"菜地加速10次",icon:null},{id:1003,reward:"1001:50",times:10,title:"菜地收获10次",desc:"菜地收获10次",icon:null},{id:1004,reward:"1001:50",times:5,title:"偷菜5次",desc:"偷菜5次",icon:null},{id:1005,reward:"1002:200",times:3,title:"喂养狗狗3次",desc:"喂养狗狗3次",icon:null},{id:1013,reward:"1001:50",times:5,title:"邀请好友",desc:"邀请5个好友",icon:null},{id:1007,reward:"1001:20",times:10,title:"购买种子10次",desc:"购买种子10次",icon:null},{id:1008,reward:"1002:500",times:3,title:"出售作物3次",desc:"出售作物3次",icon:null},{id:1009,reward:"1001:100",times:5,title:"添加好友",desc:"添加好友5个",icon:null},{id:1010,reward:"1001:100",times:10,title:"分享得好礼",desc:"分享10次",icon:null},{id:1011,reward:"1002:500",times:3,title:"任意种植",desc:"任意种植3次",icon:null},{id:1012,reward:"1001:50",times:5,title:"看视频领福利",desc:"看视频5次",icon:null}],signIn:[{id:1001,days:7,reward:"1001:20000"},{id:1002,days:10,reward:"1001:30000"},{id:1003,days:15,reward:"1001:50000"},{id:1004,days:20,reward:"1001:80000"},{id:1005,days:30,reward:"1001:120000"},{id:1006,days:50,reward:"1001:180000"},{id:1007,days:80,reward:"1001:300000"},{id:1008,days:100,reward:"1001:350000"},{id:1009,days:150,reward:"1001:500000"}],plant:[{id:1001,name:"水稻",icon:"plant_icon/1002_seed.png",seed_price:"1002:50",gain:"1001:0,1002:50",harvest:"1~2",mature_time:"180",unlock_cost:null,unlock_reward:null,desc:"种下一粒种子，收获整个世界"},{id:1002,name:"大豆",icon:"plant_icon/1004_seed.png",seed_price:"1002:50",gain:"1001:0,1002:50",harvest:"1~2",mature_time:"180",unlock_cost:null,unlock_reward:null,desc:"种下一粒种子，收获整个世界"},{id:1003,name:"大蒜",icon:"plant_icon/1012_seed.png",seed_price:"1002:50",gain:"1001:0,1002:50",harvest:"1~2",mature_time:"240",unlock_cost:null,unlock_reward:null,desc:"种下一粒种子，收获整个世界"},{id:1004,name:"包心菜",icon:"plant_icon/1006_seed.png",seed_price:"1002:75",gain:"1001:1,1002:75",harvest:"1~2",mature_time:"300",unlock_cost:"1002:1000",unlock_reward:"1001:0,1002:0",desc:"种下一粒种子，收获整个世界"},{id:1005,name:"土豆",icon:"plant_icon/1007_seed.png",seed_price:"1002:75",gain:"1001:1,1002:75",harvest:"2~3",mature_time:"300",unlock_cost:"1002:1000",unlock_reward:"1001:0,1002:0",desc:"种下一粒种子，收获整个世界"},{id:1006,name:"萝卜",icon:"plant_icon/1005_seed.png",seed_price:"1002:75",gain:"1001:1,1002:75",harvest:"2~3",mature_time:"480",unlock_cost:"1002:1000",unlock_reward:"1001:0,1002:0",desc:"种下一粒种子，收获整个世界"},{id:1007,name:"小麦",icon:"plant_icon/1001_seed.png",seed_price:"1002:120",gain:"1001:3,1002:120",harvest:"2~3",mature_time:"480",unlock_cost:"1002:1500",unlock_reward:"1001:0,1002:0",desc:"种下一粒种子，收获整个世界"},{id:1008,name:"辣椒",icon:"plant_icon/1010_seed.png",seed_price:"1002:120",gain:"1001:3,1002:120",harvest:"2~3",mature_time:"600",unlock_cost:"1002:2000",unlock_reward:"1001:0,1002:0",desc:"种下一粒种子，收获整个世界"},{id:1009,name:"黄瓜",icon:"plant_icon/1011_seed.png",seed_price:"1002:200",gain:"1001:5,1002:200",harvest:"3~4",mature_time:"720",unlock_cost:"1002:3000",unlock_reward:"1001:0,1002:0",desc:"种下一粒种子，收获整个世界"},{id:1010,name:"茄子",icon:"plant_icon/1013_seed.png",seed_price:"1002:200",gain:"1001:5,1002:200",harvest:"3~4",mature_time:"720",unlock_cost:"1002:3500",unlock_reward:"1001:0,1002:0",desc:"种下一粒种子，收获整个世界"},{id:1011,name:"胡萝卜",icon:"plant_icon/1008_seed.png",seed_price:"1002:350",gain:"1001:7,1002:350",harvest:"3~4",mature_time:"900",unlock_cost:"1002:4500",unlock_reward:"1001:0,1002:0",desc:"种下一粒种子，收获整个世界"},{id:1012,name:"南瓜",icon:"plant_icon/1014_seed.png",seed_price:"1002:350",gain:"1001:7,1002:350",harvest:"3~4",mature_time:"900",unlock_cost:"1002:5000",unlock_reward:"1001:0,1002:0",desc:"种下一粒种子，收获整个世界"},{id:1013,name:"玉米",icon:"plant_icon/1003_seed.png",seed_price:"1002:500",gain:"1001:10,1002:500",harvest:"3~5",mature_time:"1200",unlock_cost:"1002:5500",unlock_reward:"1001:0,1002:0",desc:"种下一粒种子，收获整个世界"},{id:1014,name:"甘蔗",icon:"plant_icon/1015_seed.png",seed_price:"1002:500",gain:"1001:10,1002:500",harvest:"3~5",mature_time:"1200",unlock_cost:"1002:6000",unlock_reward:"1001:0,1002:0",desc:"种下一粒种子，收获整个世界"},{id:1015,name:"番茄",icon:"plant_icon/1009_seed.png",seed_price:"1002:500",gain:"1001:10,1002:500",harvest:"3~5",mature_time:"1200",unlock_cost:"1002:6500",unlock_reward:"1001:0,1002:0",desc:"种下一粒种子，收获整个世界"}],pet:[{id:1001,name:"旺财",icon:"pet_feed/1001_dog.png",vitality_max:100,vitality_consume:10,cost:"1002:3000",desc:"爱它就买它~它就是有点懒~",sensitive:30,ability:35},{id:1002,name:"汤圆",icon:"pet_feed/1007_dog.png",vitality_max:100,vitality_consume:15,cost:"1002:4000",desc:"颜值、智商双双在线",sensitive:35,ability:35},{id:1003,name:"肉干",icon:"pet_feed/1009_dog.png",vitality_max:100,vitality_consume:16,cost:"1002:4500",desc:"最忠诚的伙伴",sensitive:40,ability:40},{id:1004,name:"二哈",icon:"pet_feed/1002_dog.png",vitality_max:100,vitality_consume:16,cost:"1002:5000",desc:"绝不拆家！",sensitive:45,ability:45},{id:1005,name:"大眼睛",icon:"pet_feed/1005_dog.png",vitality_max:100,vitality_consume:17,cost:"1002:7000",desc:"活好吃的少",sensitive:50,ability:50},{id:1006,name:"小尾巴",icon:"pet_feed/1004_dog.png",vitality_max:100,vitality_consume:18,cost:"1002:7500",desc:"武力天赋已点满~拿捏！",sensitive:50,ability:55},{id:1007,name:"球球",icon:"pet_feed/1008_dog.png",vitality_max:100,vitality_consume:18,cost:"1002:8000",desc:"就两个字，听话！",sensitive:53,ability:60},{id:1008,name:"小白",icon:"pet_feed/1003_dog.png",vitality_max:100,vitality_consume:18,cost:"1002:8000",desc:"看家、看菜、看孩子",sensitive:58,ability:65},{id:1009,name:"点点",icon:"pet_feed/1006_dog.png",vitality_max:100,vitality_consume:19,cost:"1002:10000",desc:"你值得拥有！",sensitive:60,ability:70},{id:1010,name:"闷墩",icon:"pet_feed/1010_dog.png",vitality_max:100,vitality_consume:30,cost:"1002:15000",desc:"长得就很凶，抓小偷更凶",sensitive:65,ability:80}],order:[{id:1,commission:"1.12",condition:"1001:2",extra_reward:"1001:80"},{id:2,commission:"0.87",condition:"1001:1,1002:2",extra_reward:"1001:80"},{id:3,commission:"0.69",condition:"1001:1,1003:2,1002:3",extra_reward:"1001:80"},{id:4,commission:"0.61",condition:"1002:4,1003:3,1004:3,1001:4",extra_reward:"1001:80"},{id:5,commission:"0.61",condition:"1004:6,1002:5,1005:4,1001:5",extra_reward:"1001:80"},{id:6,commission:"0.68",condition:"1003:10,1004:5,1005:3,1006:3",extra_reward:"1001:80"},{id:7,commission:"0.43",condition:"1007:4,1003:5,1004:7,1006:10",extra_reward:"1001:80"},{id:8,commission:"0.56",condition:"1008:13,1007:3,1005:5,1002:5",extra_reward:"1001:80"},{id:9,commission:"0.39",condition:"1006:2,1009:10,1007:8,1003:8",extra_reward:"1001:80"},{id:10,commission:"0.22",condition:"1006:10,1010:5,1008:10,1009:6",extra_reward:"1001:80"},{id:11,commission:"0.76",condition:"1009:5,1004:10,1001:9,1002:10",extra_reward:"1001:100"},{id:12,commission:"0.43",condition:"1007:6,1003:11,1011:6,1005:10",extra_reward:"1001:100"},{id:13,commission:"0.17",condition:"1010:5,1005:13,1001:8,1012:8",extra_reward:"1001:100"},{id:14,commission:"0.55",condition:"1013:10,1008:8,1006:6,1001:10",extra_reward:"1001:100"},{id:15,commission:"0.48",condition:"1002:10,1005:10,1011:12,1001:10",extra_reward:"1001:100"},{id:16,commission:.29,condition:"1008:11,1014:4,1006:8,1005:17",extra_reward:"1001:100"},{id:17,commission:.37,condition:"1006:14,1007:6,1015:12,1001:14",extra_reward:"1001:100"},{id:18,commission:.48,condition:"1008:14,1011:12,1009:15,1002:5",extra_reward:"1001:100"},{id:19,commission:.75,condition:"1013:10,1003:20,1014:11,1001:7",extra_reward:"1001:100"},{id:20,commission:.67,condition:"1003:10,1011:17,1002:14,1005:12",extra_reward:"1001:100"},{id:21,commission:.64,condition:"1010:10,1003:14,1005:16,1007:15",extra_reward:"1001:120"},{id:22,commission:"0.4",condition:"1015:19,1007:12,1011:5,1004:17",extra_reward:"1001:120"},{id:23,commission:"0.4",condition:"1003:19,1014:22,1015:16,1008:14",extra_reward:"1001:120"},{id:24,commission:.77,condition:"1014:13,1001:17,1008:18,1004:15",extra_reward:"1001:120"},{id:25,commission:"0.39",condition:"1012:23,1011:19,1010:15,1015:20",extra_reward:"1001:120"},{id:26,commission:.03,condition:"1002:21,1011:12,1012:22,1003:19",extra_reward:"1001:120"},{id:27,commission:.49,condition:"1007:16,1014:16,1006:20,1011:17",extra_reward:"1001:120"},{id:28,commission:.53,condition:"1014:17,1007:12,1011:17,1003:17",extra_reward:"1001:120"},{id:29,commission:.77,condition:"1012:10,1005:16,1010:14,1015:18",extra_reward:"1001:120"},{id:30,commission:"0.34",condition:"1011:17,1014:19,1006:14,1004:30",extra_reward:"1001:120"},{id:31,commission:.53,condition:"1007:18,1010:14,1013:19,1006:11",extra_reward:"1001:150"},{id:32,commission:.46,condition:"1013:19,1005:22,1012:12,1008:20",extra_reward:"1001:150"},{id:33,commission:"0.44",condition:"1012:16,1013:20,1002:23,1009:16",extra_reward:"1001:150"},{id:34,commission:"0.42",condition:"1009:19,1010:12,1011:14,1012:20",extra_reward:"1001:150"},{id:35,commission:"0.33",condition:"1001:18,1004:19,1013:16,1003:20",extra_reward:"1001:150"},{id:36,commission:.21,condition:"1003:11,1008:17,1014:17,1007:19",extra_reward:"1001:150"},{id:37,commission:.44,condition:"1012:19,1010:20,1002:14,1011:11",extra_reward:"1001:150"},{id:38,commission:.22,condition:"1014:13,1004:19,1002:11,1015:18",extra_reward:"1001:150"},{id:39,commission:.36,condition:"1007:18,1012:13,1004:16,1002:26",extra_reward:"1001:150"},{id:40,commission:.28,condition:"1004:30,1005:10,1008:18,1011:16",extra_reward:"1001:150"},{id:41,commission:"0.48",condition:"1010:18,1009:18,1008:17,1011:26",extra_reward:"1001:500"},{id:42,commission:.43,condition:"1009:21,1005:18,1007:20,1002:23",extra_reward:"1001:800"},{id:43,commission:"0.24",condition:"1006:30,1004:14,1014:11,1008:15",extra_reward:"1001:1000"},{id:44,commission:.62,condition:"1009:15,1003:28,1002:34,1007:19",extra_reward:"1001:1600"},{id:45,commission:"0.41",condition:"1012:15,1010:23,1007:13,1011:13",extra_reward:"1001:2200"},{id:46,commission:.39,condition:"1003:22,1007:23,1010:16,1002:24",extra_reward:"1001:2800"},{id:47,commission:.49,condition:"1010:24,1015:20,1003:25,1014:16",extra_reward:"1001:3400"},{id:48,commission:"0.26",condition:"1013:17,1007:24,1008:37,1001:30",extra_reward:"1001:4000"},{id:49,commission:.48,condition:"1002:26,1004:21,1009:22,1006:20",extra_reward:"1001:4600"},{id:50,commission:"0.25",condition:"1006:27,1012:19,1008:20,1015:11",extra_reward:"1001:5200"},{id:51,commission:"0.34",condition:"1011:18,1004:19,1002:25,1003:11",extra_reward:"1001:5800"},{id:52,commission:.43,condition:"1015:15,1013:20,1001:25,1004:26",extra_reward:"1001:6400"},{id:53,commission:"0.28",condition:"1014:14,1012:12,1010:20,1015:18",extra_reward:"1001:7000"},{id:54,commission:.45,condition:"1005:22,1002:33,1009:16,1015:17",extra_reward:"1001:7600"},{id:55,commission:"0.56",condition:"1001:23,1014:19,1005:17,1010:15",extra_reward:"1001:8200"},{id:56,commission:"0.35",condition:"1006:27,1005:29,1009:17,1003:18",extra_reward:"1001:8800"},{id:57,commission:.67,condition:"1007:21,1008:17,1002:16,1009:25",extra_reward:"1001:9400"},{id:58,commission:.32,condition:"1006:20,1008:25,1005:24,1007:19",extra_reward:"1001:10000"},{id:59,commission:.79,condition:"1012:25,1009:30,1013:16,1008:15",extra_reward:"1001:10600"},{id:60,commission:.69,condition:"1015:26,1012:27,1010:31,1001:23",extra_reward:"1001:11200"},{id:61,commission:.39,condition:"1015:12,1006:25,1011:15,1002:17",extra_reward:"1001:11800"},{id:62,commission:.44,condition:"1015:21,1007:15,1011:18,1006:26",extra_reward:"1001:12400"},{id:63,commission:.01,condition:"1010:18,1005:16,1009:13,1003:27",extra_reward:"1001:13000"},{id:64,commission:.27,condition:"1007:17,1006:10,1005:29,1004:25",extra_reward:"1001:13600"},{id:65,commission:.39,condition:"1008:15,1003:30,1014:20,1005:15",extra_reward:"1001:14200"},{id:66,commission:.73,condition:"1004:25,1008:25,1002:34,1012:14",extra_reward:"1001:14800"},{id:67,commission:.13,condition:"1001:36,1012:20,1011:20,1003:20",extra_reward:"1001:15400"},{id:68,commission:.69,condition:"1013:24,1008:23,1006:16,1007:17",extra_reward:"1001:16000"},{id:69,commission:.37,condition:"1015:30,1004:29,1013:17,1009:10",extra_reward:"1001:16600"},{id:70,commission:.71,condition:"1010:23,1004:31,1011:17,1012:11",extra_reward:"1001:17200"},{id:71,commission:.29,condition:"1008:11,1002:26,1003:28,1015:13",extra_reward:"1001:17800"},{id:72,commission:.31,condition:"1005:25,1002:38,1012:19,1010:14",extra_reward:"1001:18400"},{id:73,commission:.39,condition:"1012:34,1006:22,1003:27,1004:20",extra_reward:"1001:19000"},{id:74,commission:.26,condition:"1003:20,1012:18,1002:30,1001:20",extra_reward:"1001:19600"},{id:75,commission:.18,condition:"1006:31,1014:30,1008:12,1002:25",extra_reward:"1001:20200"},{id:76,commission:.51,condition:"1007:21,1012:20,1004:11,1014:20",extra_reward:"1001:20800"},{id:77,commission:.21,condition:"1008:15,1009:16,1012:24,1007:30",extra_reward:"1001:21400"},{id:78,commission:.73,condition:"1015:16,1012:16,1006:20,1008:22",extra_reward:"1001:22000"},{id:79,commission:.65,condition:"1006:26,1004:18,1007:12,1011:27",extra_reward:"1001:22600"},{id:80,commission:.39,condition:"1009:15,1003:16,1004:19,1007:24",extra_reward:"1001:23200"},{id:81,commission:.14,condition:"1012:20,1015:28,1002:24,1003:38",extra_reward:"1001:23800"},{id:82,commission:.2,condition:"1005:12,1011:19,1009:18,1002:14",extra_reward:"1001:24400"},{id:83,commission:.53,condition:"1010:19,1003:38,1007:22,1015:20",extra_reward:"1001:25000"},{id:84,commission:.62,condition:"1005:29,1014:26,1002:18,1007:38",extra_reward:"1001:25600"},{id:85,commission:.37,condition:"1011:20,1001:17,1012:12,1004:32",extra_reward:"1001:26200"},{id:86,commission:.59,condition:"1009:25,1011:20,1006:14,1015:21",extra_reward:"1001:26800"},{id:87,commission:"0.31",condition:"1006:26,1005:19,1013:20,1014:29",extra_reward:"1001:27400"},{id:88,commission:"0.48",condition:"1008:37,1011:24,1015:12,1014:11",extra_reward:"1001:28000"},{id:89,commission:"0.22",condition:"1002:17,1003:28,1005:22,1010:31",extra_reward:"1001:28600"},{id:90,commission:.32,condition:"1002:39,1013:28,1007:25,1001:33",extra_reward:"1001:29200"},{id:91,commission:.19,condition:"1008:15,1013:20,1014:10,1007:26",extra_reward:"1001:29800"},{id:92,commission:.13,condition:"1004:38,1011:13,1008:15,1007:29",extra_reward:"1001:30400"},{id:93,commission:.34,condition:"1013:12,1001:39,1006:38,1008:31",extra_reward:"1001:31000"},{id:94,commission:.22,condition:"1002:36,1014:27,1013:16,1005:31",extra_reward:"1001:31600"},{id:95,commission:.15,condition:"1005:26,1011:34,1015:34,1008:16",extra_reward:"1001:32200"},{id:96,commission:"0.49",condition:"1003:24,1001:34,1007:28,1005:30",extra_reward:"1001:32800"},{id:97,commission:"0.6",condition:"1013:32,1009:33,1006:30,1011:40",extra_reward:"1001:33400"},{id:98,commission:"0.35",condition:"1014:40,1009:43,1015:33,1012:45",extra_reward:"1001:34000"},{id:99,commission:"0.44",condition:"1011:39,1008:37,1009:30,1013:42",extra_reward:"1001:34600"},{id:100,commission:"0.49",condition:"1012:40,1010:33,1013:30,1011:40",extra_reward:"1001:35200"}],lang:[],landLevel:[{id:1,reward:"1002:0",cost:"1002:0",gain:null,probability:.1,get_diamond:1},{id:2,reward:"1002:1500",cost:"1002:5000",gain:.1,probability:.13,get_diamond:1},{id:3,reward:"1002:2000",cost:"1002:10000",gain:.25,probability:.25,get_diamond:2},{id:4,reward:"1002:2500",cost:"1002:20000",gain:.4,probability:.38,get_diamond:3},{id:5,reward:"1002:3000",cost:"1002:50000",gain:.55,probability:.5,get_diamond:5}],feed:[{id:1001,name:"饼干",icon:"pet_feed/1001_feed.png",vitality:1,cost:"1002:30",desc:"可增加宠物&点体力"},{id:1002,name:"坚果",icon:"pet_feed/1002_feed.png",vitality:2,cost:"1002:50",desc:"可增加宠物&点体力"},{id:1003,name:"火腿",icon:"pet_feed/1003_feed.png",vitality:5,cost:"1002:100",desc:"可增加宠物&点体力"},{id:1004,name:"牛肉",icon:"pet_feed/1004_feed.png",vitality:50,cost:"1002:900",desc:"可增加宠物&点体力"},{id:1005,name:"猪肉",icon:"pet_feed/1005_feed.png",vitality:20,cost:"1002:460",desc:"可增加宠物&点体力"},{id:1006,name:"鸡肉",icon:"pet_feed/1006_feed.png",vitality:10,cost:"1002:270",desc:"可增加宠物&点体力"}],currency:[{id:1001,name:"钻石",icon:"main_scene/img_diamond.png"},{id:1002,name:"金币",icon:"main_scene/img_coin.png"}],config:[{id:"all_speed_up_times",value:30},{id:"all_speed_up_time",value:600},{id:"unlock_land_cost",value:"1002:0,1002:0,1002:5000,1002:10000,1002:20000,1002:30000,1002:40000,1002:50000,1002:60000"},{id:"goldDefault",value:"1002:100"},{id:"diamondDefault",value:"1001:50"},{id:"ADTimesLimit",value:50},{id:"ADSpeedUptimes",value:6},{id:"vitalityBuyCostGold",value:"1002:10000"},{id:"vitalityLimit",value:3},{id:"Initial_physical_strength",value:3},{id:"landAmountMax",value:9},{id:"petDefaultVitality",value:100},{id:"petDigestIntervalTime",value:3600},{id:"Videorewards",value:"1001:450:600,1001:250:350,1001:200:300,1001:100:200,1001:80:100"},{id:"withdrawal",value:"1001:10000:1"},{id:"Invitation_rewards",value:"1001:5000"},{id:"withdrawal_times",value:"0.3:1:0:0,5:1:6:30,10:1:15:60,50:1:50:80,100:1:100:90,200:0:200:97"}]};class k{static parseString(e,t=","){return e?e.split(t):[]}static formatMoney(e){return e.toString().match(/^\d+(?:\.\d{0,2})?/)}}k.formatSeconds=(e=>new Date(1e3*e).toISOString().substr(11,8));const B={pet:e=>({id:e.id,name:e.name,icon:e.icon||`pet_feed/${e.id}_dog.png`,vitality_max:e.vitality_max,vitality_consume:e.vitality_consume,cost:getRewardCurrencyBase(e.cost),desc:e.desc,sensitive:e.sensitive,ability:e.ability}),feed:e=>({id:e.id,name:e.name,icon:e.icon||`pet_feed/${e.id}_feed.png`,vitality:e.vitality,cost:getRewardCurrencyBase(e.cost),desc:e.desc}),order:e=>({id:e.id,commission:Number(e.commission),condition:k.parseString(e.condition).map(e=>{let t=k.parseString(e,":");return{plant:C.table("plant").get(Number(t[0])),count:Number(t[1])}}),extraReward:getRewardCurrencyBase(e.extra_reward)}),plant:e=>({id:e.id,name:e.name,icon:e.icon,matureIcon:`plant_icon/${e.icon.match(/\d+/g)[0]}_mature.png`,growingIcon:`plant_icon/${e.icon.match(/\d+/g)[0]}_growing.png`,gain:k.parseString(e.gain).map(e=>getRewardCurrencyBase(e)),desc:e.desc,seed_price:getRewardCurrencyBase(e.seed_price),harvest:Number(k.parseString(e.harvest,"~")[1]),mature_time:Number(e.mature_time),unlock_cost:getRewardCurrencyBase(e.unlock_cost),unlock_reward:k.parseString(e.unlock_reward).map(e=>getRewardCurrencyBase(e))}),currency:e=>({id:e.id,icon:e.icon,name:e.name}),landLevel:e=>({id:e.id,reward:getRewardCurrencyBase(e.reward),cost:getRewardCurrencyBase(e.cost),gain:e.gain,probability:e.probability,getDiamond:e.get_diamond}),config(e){switch(e.id){case"all_speed_up_times":return{id:"all_speed_up_times",value:e.value};case"all_speed_up_time":return{id:"all_speed_up_time",value:e.value};case"unlock_land_cost":return{id:"unlock_land_cost",value:k.parseString(e.value).map(e=>getRewardCurrencyBase(e))};case"goldDefault":return{id:"goldDefault",value:getRewardCurrencyBase(e.value).count};case"diamondDefault":return{id:"diamondDefault",value:getRewardCurrencyBase(e.value).count};case"ADTimesLimit":return{id:"ADTimesLimit",value:e.value};case"ADSpeedUptimes":return{id:"ADSpeedUptimes",value:e.value};case"vitalityBuyCostGold":return{id:"vitalityBuyCostGold",value:getRewardCurrencyBase(e.value).count};case"vitalityLimit":return{id:"vitalityLimit",value:e.value};case"Initial_physical_strength":return{id:"Initial_physical_strength",value:e.value};case"landAmountMax":return{id:"landAmountMax",value:e.value};case"petDefaultVitality":return{id:"petDefaultVitality",value:e.value};case"petDigestIntervalTime":return{id:"petDigestIntervalTime",value:e.value};case"Videorewards":let t=e.value.split(",")[0].split(":");return{id:"Videorewards",value:{obj:C.table("currency").get(Number(t[0])),count:Number(t[2])}};case"withdrawal":return{id:"withdrawal",value:k.parseString(e.value,":")};case"Invitation_rewards":return{id:"Invitation_rewards",value:getRewardCurrencyBase(e.value)};case"withdrawal_times":return{id:"withdrawal_times",value:k.parseString(e.value).map(e=>(e=k.parseString(e,":"),{price:Number(e[0])||0,times:Number(e[1])||0,inviteAmount:Number(e[2])||0,orderLv:Number(e[3])||0}))}}},signIn:e=>({id:e.id,days:e.days,reward:getRewardCurrencyBase(e.reward)}),task:e=>({id:e.id,times:e.times,reward:getRewardCurrencyBase(e.reward),desc:e.desc,title:e.title,icon:e.icon||"game/img_barm.png"})};function getRewardCurrencyBase(e){if(!e)return null;let t=k.parseString(e,":");return{obj:C.table("currency").get(Number(t[0])),count:Number(t[1])}}const C=new class{constructor(){this.tableCache=new Map}table(e){if(this.tableCache.has(e))return this.tableBack(this.tableCache.get(e));let t=[];return x[e].forEach(i=>{t.push(B[e](i))}),this.tableCache.set(e,t),this.tableBack(t)}tableBack(e){return{list:e,get(t){for(let i=0,a=e.length;i<a;i++)if(e[i].id==t)return e[i];return null}}}};var S=new class{constructor(){this.list=[]}init(e){e.forEach(e=>this.list.push({id:e.id,times:e.times,receive:e.receive,base:C.table("task").get(e.id)}))}getTask(e){this.updateRedDot();for(let t=0;t<this.list.length;t++)if(this.list[t].id==e)return this.list[t];return null}getList(){return this.updateRedDot(),this.list.sort((e,t)=>{var i,a;let s=this.getTask(e.id),n=this.getTask(t.id);return e.id+((null==s?void 0:s.receive)?1e3:1)+((null==s?void 0:s.times)>=(null===(i=e.base)||void 0===i?void 0:i.times)?100:1e3)-(t.id+((null==n?void 0:n.receive)?1e3:1)+((null==n?void 0:n.times)>=(null===(a=t.base)||void 0===a?void 0:a.times)?100:1e3))})}taskAddTimes(e){let t=this.getTask(e);t?(t.times++,y.eventGlobal.event("update_task"),this.updateRedDot()):console.error(`任务id ${e} 未创建`)}updateRedDot(){var e;let t=!1;for(let i=0;i<this.list.length;i++)if(!this.list[i].receive&&this.list[i].times>=(null===(e=C.table("task").get(this.list[i].id))||void 0===e?void 0:e.times)){t=!0;break}y.eventGlobal.event("update_red_dot",["task",t])}clear(){this.list.length=0}};var I=new class{constructor(){this.orderLevel=1,this.nickname="name",this.key=null,this.avatar="",this.diamond=999,this.gold=999,this.advertiseTimes=0,this.signInDays=0,this.signInId=0,this.speedUpTimes=0,this.vitality=0,this.proportion=1e-4,this.guideData=[],this.days=0,this.adTimes=0,this.continuousAdTimes=0,this.isBindWx=0}get ttt(){return this.orderLevel}set ttt(e){this.orderLevel=e}clear(){this.nickname=""}};var A=new class{constructor(){this.list=new Map}init(e){e.forEach(e=>{this.addLand(e)})}getLand(e){return this.list.get(e)}addLand(e){this.list.set(e.id,e)}clear(){this.list.clear()}};var T=new class{constructor(){this.list=[]}init(e){C.table("pet").list.forEach(t=>{this.list.push({base:t,lock:!e.includes(t.id)})})}getUnlockLen(){let e=0;return this.list.forEach(t=>{t.lock||e++}),e}clear(){this.list.length=0}};var D=new class{constructor(){this.list=[]}init(e){C.table("plant").list.forEach(t=>{this.list.push({base:t,lock:!e.includes(t.id)})})}getPlant(e){for(let t=this.list.length-1;t>-1;t++)if(this.list[t].base.id==e)return this.list[t];return null}clear(){this.list.length=0}};var N=new class{constructor(){this.list=[]}init(e){e.forEach(e=>{if(!C.table("plant").get(e.id))return console.error("错误的id "+e.id);this.list.push({base:C.table("plant").get(e.id),count:e.amount})})}reduceAmount(e,t){for(let i=0;i<this.list.length;i++)if(this.list[i].base.id==e){this.list[i].count-=t,this.list[i].count<=0&&this.list.splice(i,1);break}y.eventGlobal.event("update_Order")}getOne(e){return this.getItem(e)}getItem(e){for(let t=0;t<this.list.length;t++)if(this.list[t].base.id==e)return this.list[t];return null}add(e,t){let i=this.getItem(e);if(i)return i.count+=t,void y.eventGlobal.event("update_Order");C.table("plant").get(e)?(this.list.push({base:C.table("plant").get(e),count:t}),y.eventGlobal.event("update_Order")):console.warn("错误的id "+e)}clear(){this.list.length=0}};var V=new class{constructor(){this.intervalTime=60}init(){}updateTime(){this.timeId&&clearTimeout(this.timeId),this.timeId=setTimeout(()=>{this.updateMsg(),this.updateTime()},1e3*this.intervalTime)}updateMsg(){return __awaiter(this,void 0,void 0,function*(){let e=yield H.inst.send({api:"/mail/list"}).catch(()=>{this.error()}),t=!1;for(let i=0;i<e.length;i++)if(!e[i].read){t=!0;break}y.eventGlobal.event("update_red_dot",["mail",t]);let i=yield H.inst.send({api:"/friend/list"}).catch(()=>{this.error()});t=!1;for(let e=0;e<i.list.length;e++)if(i.list[e].steal||i.list[e].applyIng){t=!0;break}y.eventGlobal.event("update_red_dot",["friend",t])})}error(){this.timeId&&clearTimeout(this.timeId)}destroy(){clearTimeout(this.timeId)}};var O=new class{forward(e){switch(e.api){case"/login":case"/login/token":this.login(e.data);break;case"/land/speedUp":this.updateUserInfo(e.data),this.taskUpdate(1002);break;case"/ad":this.updateUserInfo(e.data),this.taskUpdate(1001);break;case"/land/gather":this.updateUserInfo(e.data),this.taskUpdate(1003);break;case"/feed/buy":this.updateUserInfo(e.data),this.taskUpdate(1005),this.taskUpdate(1006);break;case"/land/sow":this.updateUserInfo(e.data),this.taskUpdate(1007);break;case"/warehouse/sell":this.updateUserInfo(e.data),this.taskUpdate(1008);break;case"/land/steal":this.updateUserInfo(e.data);break;case"/seeds/unlock":case"/land/sow":case"/land/unlock":case"/pet/buy":case"/vitality/buy":case"/task/reward":case"/land/upgrade":case"/order/reward":this.updateUserInfo(e.data)}e.resolveEvent&&e.resolveEvent(e.data),y.eventGlobal.event(e.api,e.data)}error(e,t){switch(e){case 401:y.view.openHint({text:"登录已过期，请重新登录",call:()=>{}});break;default:y.view.openHint({text:`${null==t?void 0:t.message} \n ${(null==t?void 0:t.error)||""}`,call:()=>{}})}}login(e){var t,i,a,s;e?(D.init(e.seeds),N.init(e.warehouse),I.key=e.userInfo.key,I.diamond=e.userInfo.diamond,I.gold=e.userInfo.gold,I.nickname=e.userInfo.nickname,I.avatar=e.userInfo.avatar,I.orderLevel=e.orderId||0,I.warePetId=null===(t=e.wearPet)||void 0===t?void 0:t.id,I.petVitality=(null===(i=e.wearPet)||void 0===i?void 0:i.vitality)||0,I.digestCountDown=(null===(a=e.wearPet)||void 0===a?void 0:a.digestCountDown)||0,I.advertiseTimes=e.advertiseTimes||0,I.signInDays=e.signInDays||0,I.signInId=e.signInId,I.speedUpTimes=e.speedUpTimes,I.vitality=e.userInfo.vitality,I.invitePeople=e.userInfo.invitePeople,I.isFirstTime=e.userInfo.isFirstTime,I.guideData=(null===(s=e.userInfo.guideData)||void 0===s?void 0:s.split(""))||[],I.withdraw=e.withdraw,I.days=e.days+1,I.adTimes=e.userInfo.adTimes,I.continuousAdTimes=e.userInfo.continuousAdTimes,I.isBindWx=e.userInfo.isBindWx,T.init(e.pets),S.init(e.tasks),f.setJSON("isLogin",!0),e.token&&f.setJSON("token",e.token),A.init(e.lands),y.audio.soundMuted=f.getJSON().sound,y.audio.musicMuted=f.getJSON().music,V.init()):y.view.openHint({text:"登录错误,请重试",call:()=>{}})}loginOut(){V.destroy(),D.clear(),N.clear(),T.clear(),A.clear(),S.clear(),f.setJSON("isLogin",!1),f.setJSON("token",null),I.key=null,I.diamond=0,I.gold=0,I.nickname="",I.avatar="",I.orderLevel=0,I.warePetId=null,I.petVitality=0,I.digestCountDown=0,I.advertiseTimes=0,I.signInDays=0,I.signInId=null,I.speedUpTimes=0,I.vitality=0,I.invitePeople=null,I.isFirstTime=null,I.withdraw=[],I.guideData=[],I.days=0,I.adTimes=0,I.continuousAdTimes=0,I.isBindWx=0}updateUserInfo(e){I.gold=e.gold,I.diamond=e.diamond,I.advertiseTimes=e.advertiseTimes||0}taskUpdate(e){S.taskAddTimes(e)}};class H{constructor(){this.baseUrl=null,this.sendData=[],this.eventMap=new Map,this.xhrList=[]}init(e){this.baseUrl=e}createXhr(e,t,i){let a=new XMLHttpRequest;return a.onreadystatechange=(()=>{if(4==a.readyState)switch(a.status){case 200:case 201:const s=JSON.parse(a.responseText);s.code||i&&S.taskAddTimes(1001),this.completeHandler(s,e,t,a),this.clearOneInEventMap(a),this.queueXhrEvent();break;default:if(a.responseText){let i=JSON.parse(a.responseText);i.statusCode?y.view.openHint({text:`${a.responseText} 请重试`,call:()=>{}}):this.completeHandler(i,e,t,a),this.clearOneInEventMap(a)}a.status||(this.completeHandler({code:404,data:{message:"服务器未响应，请重试"},uri:""},e,t,a),this.clearOneInEventMap(a)),this.queueXhrEvent()}}),a}clearOneInEventMap(e){this.eventMap.forEach((t,i)=>{t==e&&this.eventMap.delete(i)})}send(e){var t;return __awaiter(this,void 0,void 0,function*(){e.method||(e.method="post"),e.responseType||(e.responseType="json"),e.baseUrl||(e.baseUrl=this.baseUrl);let a=e.baseUrl+e.api,s=[];e.data&&Object.keys(e.data).forEach(t=>{s.push(`${t}=${e.data[t]}`)});const n=s.join("&");if(this.eventMap.get(a+n))return new Promise((e,t)=>{t(null)});let o=!1;if((null===(t=e.data)||void 0===t?void 0:t.type)==g.ApiTypeAD&&this.guideAd()){console.log("run ad");const e=yield w.runAppFunction({uri:"ad",data:{},timestamp:Date.now()});if(null==e?void 0:e.code)return y.view.openHint({text:`${e.data.message}[${e.code}]`,call:()=>{}}),new Promise((e,t)=>{t(null)});o=!0,I.adTimes++,I.days>1&&((null==e?void 0:e.data.hasClicked)?I.continuousAdTimes=0:I.continuousAdTimes++,Laya.timer.once(100,this,()=>{H.inst.send({api:"/ad/record/not/click",data:{times:I.continuousAdTimes}})}))}return new Promise((t,s)=>__awaiter(this,void 0,void 0,function*(){const d=this.createXhr(t,s,o);if(this.eventMap.set(a+n,d),this.sendData.push({xhr:d,data:e}),(null==e?void 0:e.before)&&e.before(),e.headers||(e.headers=["Authorization",`Bearer ${f.getJSON().token}`]),!e.api)return y.view.open(i.views.HintView,{parm:{text:"http 地址不能为空"}}),s(null);d.open("POST",a,!0),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.setRequestHeader("Authorization",`Bearer ${f.getJSON().token}`),this.xhrList.push({xhr:d,data:n,sendData:e}),this.xhrList.length>1||this.queueXhrEvent(!0)}))})}guideAd(){let e=0;switch(I.guideData.length&&(I.guideData.forEach(t=>{"1"==t&&e++}),e>5&&(e=-1)),e){case 1:case 5:return!1;default:return!0}}queueXhrEvent(e=!1){e||this.xhrList.splice(0,1),this.xhrList.length&&(console.log(`%c ==> send %c${this.xhrList[0].sendData.api} %c${JSON.stringify(this.xhrList[0].sendData.data)}`,"color:#82ccdd;font-weight:700;","color:#eb4d4b;font-weight:700;","color:#f8c291;font-weight:700;"),this.xhrList[0].xhr.send(this.xhrList[0].data))}completeHandler(e,t,i,a){let s;for(let e=0;e<this.sendData.length;e++)if(this.sendData[e].xhr==a){s=this.sendData[e].data,this.sendData.slice(e,1);break}if(e.code)return i(e.code),(null==s?void 0:s.error)&&s.error(e.code,e.data),O.error(e.code,e.data),console.error(e);{let i=s.api;console.log(`%c <== back %c${i} `,"color:#b8e994;font-weight:700;","color:#78e08f;font-weight:700;",e.data),0===e.code&&O.forward({api:i,data:e.data,resolveEvent:t})}}errorHandler(e){console.log(e)}processHandler(e){console.log(e)}}__decorate([Instance,__metadata("design:type",H)],H,"inst",void 0);class F extends l{constructor(){super(...arguments),this.costIcon=null,this.costFont=null,this.adBtn=null,this.canClick=!0}onOpened(e){this.data=e,this.landData=C.table("config").get("unlock_land_cost").value[A.list.size],this.costIcon.skin=this.landData.obj.icon,this.costFont.value=this.landData.count+"",this.adBtn.disabled=!I.advertiseTimes,this.adBtn.active=Boolean(I.advertiseTimes),(I.adTimes>100||I.continuousAdTimes>20)&&Laya.timer.once(300,this,()=>{w.runAppFunction({uri:"ad",data:{adType:2}}),w.runAppFunction({uri:"ad",data:{adType:3}}),w.runAppFunction({uri:"eventCount",data:{type:"half_screen_advertisement"}}),w.runAppFunction({uri:"eventCount",data:{type:"bottom_advertisement"}})})}onHdAwake(){(I.adTimes>100||I.continuousAdTimes>20)&&(this.owner.getChildByName("center").centerY=-310)}onClick(e){switch(e.target.name){case"closeAddLandLayer":y.view.close(i.views.AddLandView);break;case"cost_gold":if(!this.canClick)return;if(this.landData.obj.id==g.goldId&&this.landData.count>I.gold)return void y.view.openHint({text:"金币不足，去仓库出售蔬菜可以获得金币，偷菜获得的蔬菜也可以出售获得金币哦",call:()=>{}});if(this.landData.obj.id==g.diamondId&&this.landData.count>I.diamond)return void y.view.openHint({text:"钻石不足",call:()=>{}});this.canClick=!1,H.inst.send({api:"/land/unlock",data:{landId:this.data.id,type:g.ApiTypeDefault}}).then(()=>{var e;this.canClick=!0,(null===(e=this.data)||void 0===e?void 0:e.call)&&(this.data.call(),y.view.close(i.views.AddLandView))}).catch(()=>{this.canClick=!0});break;case"ad_btn":if(!this.canClick)return;this.canClick=!1,H.inst.send({api:"/land/unlock",data:{landId:this.data.id,type:g.ApiTypeAD}}).then(t=>{var a;this.canClick=!0,(null===(a=this.data)||void 0===a?void 0:a.call)&&(this.data.call(),y.view.close(i.views.AddLandView)),y.eventGlobal.event("play_ad_get_reward",[e.target,t.adReward])}).catch(()=>{this.canClick=!0})}}onHdDestroy(){w.runAppFunction({uri:"closeAd",data:{}})}}class G extends y.gameScript{constructor(){super(...arguments),this.icon=null,this.fieldNode=null,this.shadow=null,this.fieldEmptyRes="",this.lvNode=null,this.timeBox=null,this.countDownLb=null,this.topStateIcon=null,this.upAni=null,this.reduceTime=null,this.unlockIcon="",this.fieldId=null,this.buildIng=!1,this.isOuter=!1,this.canSteal=!1,this.canClick=!0,this.matureTime=0}onHdAwake(){this.fieldNode=this.owner,this.countDownLb=this.timeBox.getChildByName("countDownLb"),this.init()}init(){this.icon.skin=null,this.showShadowIcon(!1),this.timeBox.visible=!1,this.timeBox.active=!1,this.topStateIcon.visible=!1,this.lvNode.visible=!1,this.upAni.visible=!1,this.reduceTime.visible=!1,this.upAni.on(Laya.Event.COMPLETE,this,()=>{this.upAni.visible=!1}),this.matureTime=Date.now()}updateData(e){(null==e?void 0:e.list)?this.landList=e.list:this.landList=A.list,this.data=this.landList.get(this.fieldId),this.renderData()}renderData(){var e;this.topStateIconAni(!1),this.data?(this.icon.y=164,this.showShadowIcon(!1),this.topStateIcon.visible=!1,this.fieldNode.skin=this.fieldEmptyRes,this.showIcon(Boolean(this.data.productId)),this.lvNode.visible=!0,this.updateLevel(),this.timeBox.visible=!1,this.data.productId&&this.plantIconAni(!0),this.data.productId&&this.data.matureTimeLeft>0?(this.matureTime=1e3*this.data.matureTimeLeft+Date.now(),this.timeBox.visible=!0,this.timeBox.active=!0,this.icon.skin=C.table("plant").get(this.data.productId).growingIcon,this.showShadowIcon(!0),this.updateCountDown(),this.isOuter?this.topStateIcon.visible=!1:this.plantIconAni(!0)):this.data.productId&&(this.matureTime=Date.now(),this.topStateIcon.visible=!0,this.showShadowIcon(!0),this.updateCountDown(),this.setStateIconSkin(3))):(this.lvNode.visible=!1,this.fieldNode.skin="main_scene/img_wasteland.png",this.icon.skin=this.unlockIcon,this.icon.y=113,this.showIcon(!1),this.topStateIconAni(!1),this.topStateIcon.visible=!1,this.showTimeBox(!1),this.showShadowIcon(!1),Laya.timer.clearAll(this),Laya.Tween.clearAll(this),null===(e=this.topStateIconTween)||void 0===e||e.destroy(),this.topStateIconTween=null)}showIcon(e){this.icon.visible=e}setStateIconSkin(e){switch(e){case 1:this.topStateIcon.skin="main_scene/img_speedUp.png";break;case 2:this.topStateIcon.skin="main_scene/img_landUpdateBtn2.png";break;case 3:this.topStateIcon.skin="main_scene/img_harvest.png"}}topStateIconAni(e){var t;this.topStateIcon.y=-107,this.topStateIconTween||(this.topStateIconTween=Laya.TimeLine.to(this.topStateIcon,{y:this.topStateIcon.y-50},800,null).to(this.topStateIcon,{y:this.topStateIcon.y},800),this.topStateIconTween.play(null,!0)),this.stealUid&&!(null===(t=this.data)||void 0===t?void 0:t.canSteal)&&(e=!1),this.topStateIcon.visible=e,e?this.topStateIconTween.resume():this.topStateIconTween.pause()}showTimeBox(e){this.timeBox.visible=e}showShadowIcon(e){this.shadow.visible=e,this.shadow.active=e}plantIconAni(e){this.plantIconTween||(this.plantIconTween=Laya.TimeLine.to(this.icon,{skewX:3},1e3).to(this.icon,{skewX:-3},2e3).to(this.icon,{skewX:0},1e3),this.plantIconTween.play(null,!0)),e?Laya.timer.once(1e3*Math.random(),this,()=>{this.plantIconTween.resume()}):this.plantIconTween.pause()}updateCountDown(){var e,t;this.data.matureTimeLeft>0?(this.countDownLb.text=k.formatSeconds(this.data.matureTimeLeft),Laya.timer.clearAll(this),Laya.timer.once(1e3,this,()=>(this.data.matureTimeLeft=Math.ceil((this.matureTime-Date.now())/1e3),this.data.matureTimeLeft<0&&(this.data.matureTimeLeft=0),this.countDownLb.text=k.formatSeconds(this.data.matureTimeLeft),this.updateCountDown()))):(this.data.matureTimeLeft=0,this.matureTime=Date.now(),console.log("成熟 "),this.icon.skin=null===(t=C.table("plant").get(null===(e=this.data)||void 0===e?void 0:e.productId))||void 0===t?void 0:t.matureIcon,this.buildIng||(this.setStateIconSkin(3),this.mainViewCom.updateAllStateIcon()),this.showTimeBox(!1))}updateLevel(){this.lvNode.skin=`main_scene/img_level${this.data.level}.png`}speedUp(){var e;(null===(e=this.data)||void 0===e?void 0:e.matureTimeLeft)&&(this.data.matureTimeLeft-=C.table("config").get("all_speed_up_time").value,this.matureTime=1e3*this.data.matureTimeLeft+Date.now(),this.updateCountDown(),this.reduceTime.visible=!0,this.reduceTime.alpha=0,this.reduceTime.y=-39,this.reduceTimeAni||(this.reduceTimeAni=Laya.TimeLine.to(this.reduceTime,{y:-69,alpha:1},300).to(this.reduceTime,{y:-100,alpha:0},300,null,1e3)),this.reduceTimeAni.play())}clearField(){this.topStateIcon.visible=!1,this.data.productId=null,this.icon.skin=null,this.showIcon(!1),this.showShadowIcon(!1)}onClick(){return __awaiter(this,void 0,void 0,function*(){if(y.audio.playSound(i.audios.button_click),this.canClick)if(this.isOuter)this.data&&this.stealFood(this.data);else if(this.data){if(this.buildIng)return void(C.table("landLevel").get(this.data.level+1)?y.view.open(i.views.FieldLevelUpView,{parm:{obj:this.data,call:()=>{this.data.level++,this.updateLevel(),y.audio.playSound(i.audios.tudishengji),this.upAni.visible=!0,this.upAni.play(0,!1)}}}):(console.log("满级"),this.topStateIconAni(!1),y.view.openHint({text:"已满级",call:()=>{}})));if(this.data.productId){if(this.data.matureTimeLeft)return this.mainViewCom.hideGuideHand(),console.log("加速"),y.view.open(i.views.SpeedUpView,{parm:{call:()=>{this.mainViewCom.updateAllStateIcon()}}}),void this.mainViewCom.updateAllStateIcon(this.data.id);console.log("收获"),this.gather()}else this.sow()}else this.mainViewCom.hideGuideHand(),y.view.open(i.views.AddLandView,{parm:{id:this.fieldId,call:()=>{this.data={id:this.fieldId,level:1,matureTimeLeft:0,productId:null},this.matureTime=Date.now(),A.addLand(this.data),this.updateData(),this.mainViewCom.updateHitLandAdd()}}})})}gather(){if(!this.canClick)return;this.canClick=!1;let e=0,t=0,i=this.data.productId;return new Promise(a=>{H.inst.send({api:"/land/gather",data:{landId:[this.data.id],type:g.ApiTypeDefault}}).then(s=>{let n=s.list[0];a({plantId:i,amount:n.amount,diamond:t}),e=n.amount,N.add(i,n.amount),t=n.rewardDiamond,this.canClick=!0,this.gatherEvent(i,e,t),Laya.timer.frameOnce(1,this,()=>{this.mainViewCom.updateAllStateIcon()}),1==P.inst.getGuideStep()&&y.eventGlobal.event("update_guid_data",1)}).catch(()=>{this.canClick=!0,a(null)})})}gatherEvent(e,t,a=0){y.audio.playSound(i.audios.shoucai),this.clearField();let s=[{obj:C.table("plant").get(e),count:t,posType:3}];a&&s.push({obj:C.table("currency").get(g.diamondId),count:a,posType:2}),y.eventGlobal.event("play_get_reward",{node:this.owner,list:s,callBack:()=>{}}),(I.adTimes>100||I.continuousAdTimes>20)&&(Laya.timer.once(300,this,()=>{w.runAppFunction({uri:"ad",data:{adType:1}}),w.runAppFunction({uri:"ad",data:{adType:3}})}),w.runAppFunction({uri:"eventCount",data:{type:"full_Screen"}}),w.runAppFunction({uri:"eventCount",data:{type:"bottom_advertisement"}}))}sow(){y.view.open(i.views.ShopView,{parm:{id:0,parm:{landId:this.fieldId},call:e=>{this.sowPlant(e)}}})}sowPlant(e){this.landList.get(this.fieldId).productId=e.base.id,this.landList.get(this.fieldId).matureTimeLeft=e.base.mature_time,this.matureTime=1e3*e.base.mature_time+Date.now(),this.data=this.landList.get(this.fieldId),this.renderData(),y.audio.playSound(i.audios.zhongzhi),this.mainViewCom.updateAllStateIcon(this.data.id),S.taskAddTimes(1011),w.runAppFunction({uri:"eventCount",data:{type:"plant"}})}stealFood(e){var t;return __awaiter(this,void 0,void 0,function*(){if(e.productId&&!e.matureTimeLeft){if(I.vitality<=0&&!G.stealUidState)return y.view.open(i.views.BuyVitalityView),void(this.canClick=!0);if(G.stealUidState=!0,!this.canSteal||this.stealUid&&!(null===(t=this.data)||void 0===t?void 0:t.canSteal))return console.log("已经不可偷"),void y.view.openHint({text:"给我留点吧",call:()=>{}});this.canClick=!1,H.inst.send({api:"/land/steal",data:{landId:[this.data.id],type:g.ApiTypeDefault,uid:this.stealUid}}).then(e=>{this.canClick=!0,I.vitality=e.vitality,this.stealFoodEvent(e.list[0]),4==P.inst.getGuideStep()&&(y.eventGlobal.event("update_guid_data",4),Laya.timer.frameOnce(1,this,()=>{this.mainViewCom.guide()}))}).catch(e=>{this.canClick=!0,2001===e&&this.clearField()})}})}stealFoodEvent(e,t=!0){this.data.canSteal=0,w.runAppFunction({uri:"eventCount",data:{type:"Stealvegetables"}}),S.taskAddTimes(1004),this.canSteal=!1,this.topStateIconAni(!1),P.inst.stealAll.rewardDiamond+=e.rewardDiamond;const a=[];if(e.plantId){{y.audio.playSound(i.audios.shoucai),N.add(this.data.productId,e.amount),a.push({obj:C.table("plant").get(e.plantId),count:e.amount,posType:3});let t=!1;for(let i=0;i<P.inst.stealAll.list.length;i++)if(P.inst.stealAll.list[i].plantId==e.plantId){P.inst.stealAll.list[i].amount+=e.amount,t=!0;break}t||P.inst.stealAll.list.push({plantId:e.plantId,amount:e.amount})}e.rewardDiamond&&a.push({obj:C.table("currency").get(g.diamondId),count:e.rewardDiamond,posType:2}),a.length&&y.eventGlobal.event("play_get_reward",{node:this.owner,list:a})}else{if(y.audio.playSound(i.audios.goujiaosheng),!t)return;y.view.openHint({text:"额，被狗咬了~~~没偷着~",call:()=>{}})}}onHdDestroy(){var e,t;Laya.timer.clearAll(this),Laya.Tween.clearAll(this),null===(e=this.topStateIconTween)||void 0===e||e.destroy(),null===(t=this.plantIconTween)||void 0===t||t.destroy(),this.topStateIconTween=null,this.plantIconTween=null}}G.stealUidState=!1,__decorate([y.findByName,__metadata("design:type",Laya.Image)],G.prototype,"icon",void 0),__decorate([y.findByName,__metadata("design:type",Laya.Image)],G.prototype,"fieldNode",void 0),__decorate([y.findByName,__metadata("design:type",Laya.Image)],G.prototype,"shadow",void 0),__decorate([y.findByName,__metadata("design:type",Laya.Image)],G.prototype,"lvNode",void 0),__decorate([y.findByName,__metadata("design:type",Laya.FontClip)],G.prototype,"timeBox",void 0),__decorate([y.findByName,__metadata("design:type",Laya.Image)],G.prototype,"topStateIcon",void 0),__decorate([y.findByName,__metadata("design:type",Laya.Animation)],G.prototype,"upAni",void 0),__decorate([y.findByName,__metadata("design:type",Laya.Image)],G.prototype,"reduceTime",void 0),__decorate([y.eventOn("update_field"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],G.prototype,"updateData",null),__decorate([y.eventOn("land_speed_up"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],G.prototype,"speedUp",null);class P extends y.gameScript{constructor(){super(...arguments),this.addLandLayer=null,this.diamondNode=null,this.goldNode=null,this.avatarNode=null,this.landBox=null,this.centerBox=null,this.orderBox=null,this.bottomBox=null,this.rewardShareGuide=null,this.landUpLayer=null,this.fastGetBtn=null,this.topLayerOnStage=null,this.topGoldIcon=null,this.topDiamondIcon=null,this.warehouseBtn=null,this.moneyLb=null,this.figureBox=null,this.figureBox2=null,this.getRewardPrefab=null,this.floatRewardIcon=null,this.goldAdd=null,this.diamondAdd=null,this.goHomeBtn=null,this.anyDoor=null,this.vitalityBox=null,this.vitalityBuyBtn=null,this.petBox=null,this.taskBox=null,this.step4=null,this.step5=null,this.step9=null,this.step1=null,this.guideLayer=null,this.landList=[],this.isOuter=!1,this.outCountDownNumber=60,this.canClick=!0,this.guideHand=null,this.guidIdList=[1,2,3,5],this.hasGuide=!1,this.clickTimes=0,this.stealAll={list:[],rewardDiamond:0,nickname:null},this.orderQueueIng=!1,this.hindOrderLevel=null,this.friendInviteData=[]}onOpened(){P.inst=this,["res/img_woodtitle.png","res/img_storeHouseBg.png","res/img_storebg.png","res/img_shelf.png","res/img_popUpBg.png","res/img_landBg.png","res/img_inviteBg1.png","res/img_housetop.png","res/img_farmlandLogo.png","res/atlas/plant_icon.png","res/atlas/pet_feed.png","res/atlas/main_scene.png"].forEach(e=>{}),Laya.timer.frameOnce(1,this,()=>{this.updateTask()}),this.guide(),this.guidHandAnimation(),this.guideHand.visible=!1,this.friendShareGuide(!0)}onHdAwake(){Laya.stage.addChild(this.topLayerOnStage),this.orderBox.getChildByName("friend_name").visible=!1,this.landUpLayer.visible=!1,this.landUpLayer.active=!1,this.vitalityBox.visible=!1,this.goHomeBtn.visible=!1;for(let e=0;e<this.landBox.numChildren;e++)this.landList.push(this.landBox.getChildAt(e).getComponent(G)),this.landList[e].mainViewCom=this;this.landList.sort((e,t)=>e.fieldId-t.fieldId),Laya.timer.frameOnce(1,this,()=>{y.eventGlobal.event("update_field"),this.updateHitLandAdd(),this.updateAllStateIcon()})}getGuideStep(){let e=0;return I.guideData.length&&(I.guideData.forEach(t=>{"1"==t&&e++}),e>5&&(e=-1)),e}guide(){const e=this.getGuideStep();if(5==e&&!this.isOuter)return this.guideLayer.visible=!1,this.guideLayer.disabled=!1,void this.timeGuide();if(!I.guideData.length||e>-1)switch(this.figureBox.visible=!1,this.figureBox2.visible=!1,e){case 0:y.eventGlobal.event("update_guid",{nodeList:[this.step1],call:()=>{},addPos:{x:100,y:120},text:"开始播种",testAddPos:{x:-100,y:0}});break;case 1:y.eventGlobal.event("update_guid",{nodeList:[this.step1],call:()=>{},addPos:{x:100,y:120},text:"作物种植好后，\n点击可以加速生长",testAddPos:{x:-200,y:100}});break;case 2:y.eventGlobal.event("update_guid",{nodeList:[this.step1],call:()=>{},addPos:{x:100,y:120},step:2,text:"作物已经成熟了，\n点击收获",testAddPos:{x:-200,y:100}});break;case 3:console.log("打开仓库"),y.eventGlobal.event("update_guid",{nodeList:[this.warehouseBtn],call:()=>{this.onClick({target:{name:"warehouse"}})},addPos:{x:100,y:120},text:"点击进入仓库",testAddPos:{x:200,y:230}});break;case 4:console.log("偷菜"),y.eventGlobal.event("update_guid",{nodeList:[this.anyDoor],call:()=>{this.onClick({target:{name:"any_door"}})},addPos:{x:100,y:120},text:"点击这里，可以去别人的农场偷菜哦",testAddPos:{x:-140,y:-180}});break;case 5:this.isOuter&&y.eventGlobal.event("update_guid",{nodeList:[this.vitalityBuyBtn],call:()=>{this.onClick({target:{name:"add_vitality"}})},addPos:{x:100,y:120},text:"体力消耗完了就不能偷菜了，\n点这里恢复体力",testAddPos:{x:-140,y:-200}})}else this.isOuter&&Laya.timer.once(600,this,()=>{this.goHome(),this.guideLayer.parent.mouseEnabled=!1,this.guideLayer.destroy()}),this.timeGuide(),this.figureBox.visible=!0,this.figureBox2.visible=!0}timeGuide(){-1==this.getGuideStep()&&(Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.timeGuideTouch),this.timeGuideTouch())}timeGuideTouch(){Laya.timer.clear(this,this.timeGuideAction),Laya.timer.once(15e3,this,this.timeGuideAction)}timeGuideAction(){this.hasGuide||this.isOuter||(this.timeGuideTouch(),this.guideHand.visible=!0,this.updateGuideTask())}hideGuideHand(){this.guideHand.visible=!1,this.timeGuide(),this.hasGuide=!1}updateGuideTask(){var e,t;let i,a,s=!1;for(let a=0;a<this.landList.length;a++){if(this.landList[a].data&&!this.landList[a].data.productId){s=!0;break}if((null===(e=this.landList[a].data)||void 0===e?void 0:e.productId)&&(null===(t=this.landList[a].data)||void 0===t?void 0:t.matureTimeLeft)){i=this.landList[a];break}}for(let e=0;e<this.landList.length;e++)if(!this.landList[e].data){a=this.landList[e];break}!a&&this.guidIdList.indexOf(5)>-1&&(this.guidIdList.splice(this.guidIdList.indexOf(5),1),console.log(this.guidIdList)),this.hasGuide=!0;let n={x:0,y:0};if(s)n=this.getNodeTopLayerPos(this.step4);else{if(!i)return null;switch(this.guidIdList[Math.floor(Math.random()*this.guidIdList.length)]){case 1:(n=this.getNodeTopLayerPos(i.owner)).x+=100,n.y+=100;break;case 2:(n=this.getNodeTopLayerPos(this.step9)).x+=100,n.y+=100;break;case 3:(n=this.getNodeTopLayerPos(this.step5)).x+=100,n.y+=100;break;case 5:(n=this.getNodeTopLayerPos(a.owner)).x+=100,n.y+=100}}this.guideHand.pos(n.x,n.y)}getNodeTopLayerPos(e){return this.topLayerOnStage.globalToLocal(e.parent.localToGlobal(new Laya.Point(e.x,e.y)))}guidHandAnimation(){this.guidHandAni=Laya.TimeLine.to(this.guideHand,{rotation:-15},400,null).to(this.guideHand,{rotation:0},400),this.guidHandAni.play(null,!0)}updateHitLandAdd(){let e;for(let t=0,i=this.landList.length;t<i;t++){if(!this.landList[t].data){this.landList[t].showIcon(!0);break}e||(e=this.landList[t])}}updateAllStateIcon(e){for(let e=0,t=this.landList.length;e<t;e++)this.landList[e].topStateIconAni(!1);for(let t=0,i=this.landList.length;t<i;t++){const i=this.landList[t].data;if(i){if(i.id==e){this.landList[t].showIcon(!0),this.landList[t].setStateIconSkin(1),this.landList[t].topStateIconAni(!0);break}if(!e&&i.productId&&i.matureTimeLeft){this.landList[t].showIcon(!0),this.landList[t].setStateIconSkin(1),this.landList[t].topStateIconAni(!0);break}}}for(let e=0,t=this.landList.length;e<t;e++){const t=this.landList[e].data;t&&t.productId&&!t.matureTimeLeft&&(this.landList[e].showIcon(!0),this.landList[e].setStateIconSkin(3),this.landList[e].topStateIconAni(!0))}}onHdEnable(){y.observableProperty.watch(I,this).key("diamond",e=>{this.diamondNode.value=e,this.moneyLb.value=(e*I.proportion).toString().match(/^\d+(?:\.\d{0,2})?/)+""}).key("gold",e=>{this.goldNode.value=e}).key("avatar",e=>{e&&(this.avatarNode.skin=e)}).key("warePetId",e=>{e?(this.petBox.visible=!0,this.petBox.getChildByName("dog_ani").source=`res/dog_${e}.atlas`):this.petBox.visible=!1}).key("petVitality",e=>{if(I.warePetId&&this.petBox.visible){let t=this.petBox.getChildByName("box").getChildByName("vitality_bar"),i=e/C.table("pet").get(I.warePetId).vitality_max;i>1&&(i=1),t.width=130*i,this.petBox.getChildByName("box").getChildByName("hungry").visible=!e}}).key("digestCountDown",e=>{Laya.timer.clear(this,this.digestCountDown),this.petBox.visible&&Laya.timer.once(1e3*e,this,this.digestCountDown)}).key("vitality",e=>{let t=C.table("config").get("vitalityLimit").value,i=e/t;Laya.timer.frameOnce(1,this,()=>{y.eventGlobal.event("update_red_dot",["anyDoor",Boolean(e)])}),i>=1?(i=1,this.vitalityBuyBtn.gray=!0,Laya.timer.frameOnce(1,this,()=>{this.vitalityBuyBtn.mouseEnabled=!1})):(this.vitalityBuyBtn.gray=!1,Laya.timer.frameOnce(1,this,()=>{this.vitalityBuyBtn.mouseEnabled=!0})),this.vitalityBox.getChildByName("bar")&&(this.vitalityBox.getChildByName("bar").width=268*i),this.vitalityBox.getChildByName("bar_num").text=`${e}/${t}`}),this.addLandLayer.visible=!1,this.updateOrder()}digestCountDown(){if(!I.warePetId)return;const e=C.table("pet").get(I.warePetId);I.petVitality-e.vitality_consume<=0?I.petVitality=0:I.petVitality-=e.vitality_consume,I.digestCountDown=g.petDigestIntervalTime}onClick(e){switch(console.log(e.target.name),(I.adTimes>100||I.continuousAdTimes>20)&&(this.clickTimes++,this.clickTimes%5||(w.runAppFunction({uri:"ad",data:{adType:1}}),w.runAppFunction({uri:"ad",data:{adType:3}}),w.runAppFunction({uri:"eventCount",data:{type:"full_Screen"}}),w.runAppFunction({uri:"eventCount",data:{type:"bottom_advertisement"}}))),e.target.name){case"closeAddLandLayer":this.addLandLayer.visible=!1;break;case"task":y.view.open(i.views.TaskView);break;case"mail":this.openMail();break;case"shop":y.view.open(i.views.ShopView),this.hideGuideHand();break;case"head":y.view.open(i.views.SettingView);break;case"warehouse":y.view.open(i.views.WarehouseView);break;case"buy_feed":y.view.open(i.views.ShopView,{parm:{id:2}});break;case"dog_house":y.view.open(i.views.ShopView,{parm:{id:1}});break;case"dog_ani":y.view.open(i.views.ShopView,{parm:{id:2}});break;case"diamond_box":case"money_red_box":y.view.open(i.views.ShopView,{parm:{id:3}});break;case"order_box":y.view.open(i.views.OrderView);break;case"friends":this.openFriend();break;case"land":break;case"landLevelUp":this.isOuter||this.switchLandLevelUp(!0);break;case"close_up":this.switchLandLevelUp(!1);break;case"any_door":this.goToNeighbor();break;case"go_home":this.goHome();break;case"add_vitality":this.buyVitality();break;case"reward_share_guide":this.goFriendRewardView();break;case"fast_get":this.fastGet()}}fastGet(){var e,t,a,s,n;return __awaiter(this,void 0,void 0,function*(){if(this.canClick)if(this.canClick=!1,this.isOuter){if(I.vitality<=0&&!G.stealUidState)return y.view.open(i.views.BuyVitalityView),void(this.canClick=!0);let s=[],n=[];for(let i=0;i<this.landList.length;i++)(null===(e=this.landList[i].data)||void 0===e?void 0:e.productId)&&!(null===(t=this.landList[i].data)||void 0===t?void 0:t.matureTimeLeft)&&(null===(a=this.landList[i].data)||void 0===a?void 0:a.canSteal)&&(s.push(this.landList[i].data.id),n.push(this.landList[i]));if(!s.length)return y.view.openHint({text:"没有可以偷的",call:()=>{}}),void(this.canClick=!0);G.stealUidState=!0,H.inst.send({api:"/land/steal",data:{landId:s,type:g.ApiTypeDefault,uid:n[0].stealUid}}).then(e=>{this.canClick=!0,I.vitality=e.vitality,e.list.forEach((e,t)=>{n[t].stealFoodEvent(e,!1)})}).catch(()=>{this.canClick=!0})}else{let e=0,t=[],a=[],o=[];for(let e=0;e<this.landList.length;e++)(null===(s=this.landList[e].data)||void 0===s?void 0:s.productId)&&!(null===(n=this.landList[e].data)||void 0===n?void 0:n.matureTimeLeft)&&(a.push(this.landList[e].data.id),o.push(this.landList[e]));if(!a.length)return y.view.openHint({text:"没有成熟的农作物",call:()=>{}}),void(this.canClick=!0);H.inst.send({api:"/land/gather",data:{landId:a,type:g.ApiTypeDefault}}).then(a=>{this.canClick=!0,a.list.forEach(i=>{e+=i.rewardDiamond,N.add(i.plantId,i.amount);for(let e=0;e<t.length;e++)if(t[e].plantId==i.plantId)return void(t[e].amount+=i.amount);t.push({plantId:i.plantId,amount:i.amount})}),y.view.open(i.views.GatherDescView,{parm:{type:3,data:t,diamond:e,call:e=>{let t=1;e&&(t=2),a.list.forEach((i,a)=>{e&&N.add(i.plantId,i.amount),o[a].gatherEvent(i.plantId,i.amount*t,i.rewardDiamond*t)})}}})})}})}sow(e=!1,t){var i,a;let s=!0;for(let n=0,o=this.landList.length;n<o;n++)if(!(null===(a=null===(i=this.landList[n])||void 0===i?void 0:i.data)||void 0===a?void 0:a.productId)){e?this.landList[n].sowPlant(t):this.landList[n].sow(),s=!1;break}s&&y.view.openHint({text:"没有空的土地哦！",call:()=>{}})}getEmptyLandId(){console.log(this.landList);for(let e=0,t=this.landList.length;e<t;e++)if(this.landList[e].data&&!this.landList[e].data.productId)return this.landList[e].fieldId;return null}openMail(){this.canClick&&(this.canClick=!1,H.inst.send({api:"/mail/list"}).then(e=>{y.view.open(i.views.MailView,{parm:e}),this.canClick=!0}).catch(()=>{this.canClick=!0}))}openFriend(e=null){this.canClick&&(this.canClick=!1,H.inst.send({api:"/friend/list"}).then(t=>{this.canClick=!0,y.view.open(i.views.FriendsView,{parm:{friendData:t,type:e}})}).catch(()=>{this.canClick=!0}))}buyVitality(){y.view.open(i.views.BuyVitalityView)}updateOrder(){var e;if(this.isOuter)return;let t,a=this.orderBox.getChildByName("order_box"),s=C.table("order").get(I.orderLevel+1),n=0,o=0,d=0,l=0,r=0;if(!s)return console.log("等级已完");for(let i=0;i<4;i++){let c=a.getChildByName("item_"+i);s.condition[i]?((d=(null===(e=N.getOne(s.condition[i].plant.id))||void 0===e?void 0:e.count)||0)>=(l=s.condition[i].count)&&r++,c.getChildByName("icon").skin=s.condition[i].plant.icon,c.getChildByName("num").text=`${d}/${l}`,c.getChildByName("bar").width=87*(d/l>1?1:d/l),c.visible=!0,s.condition[i].plant.gain.forEach(e=>{e.obj.id===g.goldId?(t||(t=e),n+=e.count*l):o+=e.count*l})):c.visible=!1}if(t){let e=a.getChildByName("gold_box"),i=a.getChildByName("diamond_box");e.getChildByName("icon").skin=t.obj.icon,e.getChildByName("value").value=`${n+Math.floor(n*s.commission)}`,s.extraReward?(i.getChildByName("icon").skin=s.extraReward.obj.icon,i.getChildByName("value").value=`${s.extraReward.count+o+Math.floor(o*s.commission)}`,i.visible=!0,e.y=46):(e.y=66,i.visible=!1)}if(a.getChildByName("name_title").text=`完成${I.orderLevel+1}级订单`,!this.orderQueueIng)if(r==s.condition.length){if(-1!=this.getGuideStep()&&this.getGuideStep()<=3)return;const e=s.condition;this.orderQueueIng=!0;let t=s.extraReward.count+o+Math.floor(o*s.commission),d=n+Math.floor(n*s.commission);if(Laya.timer.frameOnce(1,this,()=>{y.eventGlobal.event("update_red_dot",["order",!0])}),this.hindOrderLevel)return void(this.orderQueueIng=!1);this.hindOrderLevel=1,Laya.timer.once(500,this,()=>{y.view.open(i.views.GatherDescView,{parm:{type:1,data:{diamond:t,gold:d},call:i=>{this.hindOrderLevel=0,e.forEach(e=>{N.reduceAmount(e.plant.id,e.count)}),this.orderQueueIng=!1,I.orderLevel++;let n=[];n.push({obj:C.table("currency").get(g.goldId),count:d*(i?2:1),posType:1}),s.extraReward&&n.push({obj:C.table("currency").get(s.extraReward.obj.id),count:t*(i?2:1),posType:2}),this.playGetRewardAni({node:a.getChildByName("gold_box"),list:n,callBack:()=>{this.updateOrder()}}),i||I.orderLevel%3||Laya.timer.once(300,this,()=>{w.runAppFunction({uri:"ad",data:{adType:1}}),w.runAppFunction({uri:"eventCount",data:{type:"full_Screen"}})})},closeEvent:()=>{this.orderQueueIng=!1}}})})}else Laya.timer.frameOnce(1,this,()=>{y.eventGlobal.event("update_red_dot",["order",!1])})}switchLandLevelUp(e){let t=this.landUpLayer.getChildByName("bg");e?(this.hideGuideHand(),t.alpha=0,Laya.Tween.to(t,{alpha:.75},150),this.landUpLayer.getChildByName("land_outer").addChild(this.landBox),this.landUpLayer.active=!0,this.landUpLayer.visible=!0,this.landList.forEach(e=>{e.data&&C.table("landLevel").get(e.data.level+1)&&(e.showIcon(!1),e.setStateIconSkin(2),e.topStateIconAni(!0),e.showTimeBox(!1),e.showShadowIcon(!1)),e.buildIng=!0})):(Laya.Tween.to(t,{alpha:0},150,null,Laya.Handler.create(this,()=>{this.landUpLayer.active=!1,this.landUpLayer.visible=!1,this.centerBox.addChild(this.landBox)})),this.landList.forEach(e=>{e.data&&(e.showIcon(!0),e.data.id?(e.data.matureTimeLeft&&(e.showTimeBox(!0),e.showShadowIcon(!0)),e.data.productId||e.clearField()):e.clearField()),e.buildIng=!1,e.data?(e.data.id&&e.setStateIconSkin(e.data.matureTimeLeft?1:3),e.topStateIconAni(Boolean(e.data.productId))):(e.setStateIconSkin(1),e.topStateIconAni(!1))}))}playGetRewardAni(e){Laya.timer.once(2e3,this,()=>{e.callBack&&e.callBack()}),e.list.forEach((t,i)=>{var a;if(!t.obj)return;let s=Laya.Pool.getItemByCreateFun("floatRewardBox",this.getRewardPrefab.create,this.getRewardPrefab),n=s.getChildByName("icon");n.skin=(null===(a=t.obj)||void 0===a?void 0:a.icon)||"";let o=80/n.width;n.scale(o,o),s.alpha=0;let d=this.topLayerOnStage.globalToLocal(e.node.localToGlobal(new Laya.Point));if(s.pos(d.x+e.node.get_width()*e.node.anchorX,d.y-60*i),this.topLayerOnStage.addChild(s),s.getChildByName("count").value="x"+t.count,!(null==e?void 0:e.notFly))switch(t.posType){case 1:this.addGoldDiamondAni(this.goldAdd,t.count);break;case 2:this.addGoldDiamondAni(this.diamondAdd,t.count)}Laya.Tween.to(s,{y:s.y-40,alpha:1},150,null,Laya.Handler.create(this,i=>{Laya.timer.once(1e3,this,()=>{Laya.Pool.recover("floatRewardBox",i);let a=this.topLayerOnStage.globalToLocal(i.localToGlobal(Laya.Point.create()));if(i.removeSelf(),!e.notFly)for(let e=0;e<5;e++){let i,s=Laya.Pool.getItemByCreateFun("floatRewardIcon",this.floatRewardIcon.create,this.floatRewardIcon);switch(s.skin=t.obj.icon,s.pos(a.x+20*Math.random()*(Math.random()<.5?1:-1),a.y+20*Math.random()*(Math.random()<.5?1:-1)),s.scale(o,o),this.topLayerOnStage.addChild(s),s.zOrder=999,t.posType){case 1:i=this.topGoldIcon;break;case 2:i=this.topDiamondIcon;break;case 3:i=this.warehouseBtn}let n=i.localToGlobal(new Laya.Point(i.width/2,i.height/2)),d=this.topLayerOnStage.globalToLocal(n);Laya.Tween.to(s,{x:d.x,y:d.y},1e3,Laya.Ease.backIn,Laya.Handler.create(this,e=>{e.removeSelf(),Laya.Pool.recover("floatRewardIcon",e)},[s]),150*e)}})},[s]),50*i,null,!0)})}addGoldDiamondAni(e,t){e.visible=!0,e.alpha=0,e.value=`+${t}`,e.y=30,e.offAll(),Laya.Tween.to(e,{alpha:1,y:-30},500,null,new Laya.Handler(this,()=>{Laya.timer.once(2e3,this,()=>{e.alpha=0})}))}playAdReward(e,t){let i=[];null==t||t.forEach(e=>{console.log(e.id==g.goldId?2:1),i.push({obj:C.table("currency").get(e.id),count:e.amount,posType:e.id==g.goldId?1:2})}),y.eventGlobal.event("play_get_reward",{node:e,list:i})}updateTask(){const e=this.taskBox,t=e.getChildByName("icon"),i=t.getChildByName("amountFont"),a=e.getChildByName("lb"),s=S.getList()[0];this.isOuter&&(e.visible=!1),1==s.receive||this.isOuter?e.visible=!1:(e.visible=!0,a.text=`任务:${s.base.desc}(${s.times>s.base.times?s.base.times:s.times}/${s.base.times})`,i.value="x"+s.base.reward.count,t.skin=s.base.reward.obj.icon,e.width=a.width+100)}goHome(){y.view.setOverView(!0,()=>{H.inst.send({api:"/goHome",data:{clear:!0}}).then(()=>{this.goHomeNodeData()})})}goHomeNodeData(e=!1){e&&(this.outerTime=Date.now()),this.isOuter=!1,Laya.timer.once(300,this,()=>{y.view.setOverView(!1),this.goFriend(null),this.updateHitLandAdd(),this.stealAll.list.length&&((I.adTimes>100||I.continuousAdTimes>20)&&(w.runAppFunction({uri:"ad",data:{adType:1}}),w.runAppFunction({uri:"ad",data:{adType:3}}),w.runAppFunction({uri:"eventCount",data:{type:"full_Screen"}}),w.runAppFunction({uri:"eventCount",data:{type:"bottom_advertisement"}})),y.view.open(i.views.GatherDescView,{parm:{type:2,data:this.stealAll.list,diamond:this.stealAll.rewardDiamond,nickname:this.stealAll.nickname,call:(e,t)=>__awaiter(this,void 0,void 0,function*(){if(e){let e=yield H.inst.send({api:"/land/steal",data:{landId:[],type:g.ApiTypeAD,uid:0}}),a=0;const s=[];e.list.forEach(e=>{N.add(e.plantId,e.amount),I.diamond+=e.rewardDiamond,a+=e.rewardDiamond,s.push({obj:C.table("plant").get(e.plantId),count:e.amount,posType:3})}),s.length&&y.eventGlobal.event("play_get_reward",{node:t,list:s}),e.adReward.forEach((e,t)=>{a&&e.id==g.diamondId&&(e.amount+=a)}),y.eventGlobal.event("play_ad_get_reward",[t,e.adReward]),y.view.close(i.views.GatherDescView)}})}}))})}goToNeighbor(){this.hideGuideHand(),y.view.setOverView(!0,()=>{this.stealAll={list:[],rewardDiamond:0,nickname:null},H.inst.send({api:"/neighbor",data:4==P.inst.getGuideStep()?{type:g.ApiTypeDefault,isGuide:"11"}:{type:g.ApiTypeDefault}}).then(e=>{this.isOuter=!0,this.goFriend(e),Laya.timer.once(300,this,()=>{y.view.setOverView(!1),4==P.inst.getGuideStep()&&Laya.timer.once(300,this,()=>{y.eventGlobal.event("update_guid",{nodeList:[this.step1],call:()=>{},addPos:{x:100,y:120},text:"点击有小手的作物即可偷菜",testAddPos:{x:-160,y:-180}})})})})})}goFriendListen(e,t){this.outCountDownNumber=60,this.isOuter||(this.stealAll={list:[],rewardDiamond:0,nickname:null}),this.isOuter=!0,this.goFriend(e,t)}goFriend(e,t){var i;let a=this.landList,s=A.list,n=new Map;this.isOuter?(5==P.inst.getGuideStep()&&I.vitality<3&&Laya.timer.once(300,this,()=>{this.guide()}),e.lands.forEach(e=>{n.set(e.id,e)}),this.outerTime=Date.now(),this.vitalityBox.visible=!0,this.goHomeBtn.visible=!0,this.anyDoor.visible=!1):(s.forEach(e=>{e.matureTimeLeft-=(Date.now()-this.outerTime)/1e3,e.matureTimeLeft<0&&(e.matureTimeLeft=0)}),this.vitalityBox.visible=!1,this.anyDoor.visible=!0,this.goHomeBtn.visible=!1);for(let t=0;t<a.length;t++){const s=a[t];this.isOuter?(s.isOuter=!0,s.stealUid=e.uid,G.stealUidState=!1,s.updateData({list:n}),e.protectedTime?(s.canSteal=!1,s.topStateIconAni(!1)):s.canSteal=!0):(s.canSteal=!1,s.isOuter=!1,s.stealUid=null,G.stealUidState=!1,s.updateData({list:null})),s.plantIconAni(Boolean(null===(i=s.data)||void 0===i?void 0:i.productId))}this.updateAllStateIcon(),this.isOuter?this.taskBox.visible=!1:this.taskBox.visible=!0,this.updateFriendView(e,t)}updateFriendView(e,t){const i=null==e?void 0:e.nickname,a=null==e?void 0:e.dogId,s=(null==t?void 0:t.avatar)||(null==e?void 0:e.avatar)||"main_scene/img_defaultPortrait.png",n=this.orderBox.parent,o=n.getChildByName("money_box"),d=n.getChildByName("count_down"),l=this.orderBox.getChildByName("order_box"),r=this.orderBox.getChildByName("friend_name"),c=[this.bottomBox.getChildByName("task"),this.bottomBox.getChildByName("order_box"),this.bottomBox.getChildByName("mail")];this.isOuter?(r.text=`${i}的农场`,l.visible=!1,r.visible=!0,o.visible=!1,d.visible=!0,this.stealAll.nickname=i,d.text=k.formatSeconds(this.outCountDownNumber),s&&(this.avatarNode.skin=s),a?(this.petBox.visible=!0,this.petBox.getChildByName("dog_ani").source=`res/dog_${a}.atlas`):this.petBox.visible=!1,this.petBox.getChildByName("box").visible=!1,this.figureBox.visible=!1,this.figureBox2.visible=!1,this.fastGetBtn.skin="main_scene/img_ongkeySteel.png",-1==P.inst.getGuideStep()?Laya.timer.loop(1e3,this,this.outCountDownEvent,[d]):d.set_visible(!1)):(this.fastGetBtn.skin="main_scene/img_ongkeyGet.png",this.figureBox.visible=!0,this.figureBox2.visible=!0,this.outCountDownNumber=60,Laya.timer.clear(this,this.outCountDownEvent),l.visible=!0,r.visible=!1,o.visible=!0,d.visible=!1,I.avatar?this.avatarNode.skin=I.avatar:this.avatarNode.skin="main_scene/img_defaultPortrait.png",I.warePetId?(this.petBox.visible=!0,this.petBox.getChildByName("dog_ani").source=`res/dog_${I.warePetId}.atlas`):this.petBox.visible=!1,this.petBox.getChildByName("box").visible=!0),c.forEach(e=>{e.disabled=this.isOuter})}outCountDownEvent(e){this.outCountDownNumber--,e.text=k.formatSeconds(this.outCountDownNumber),this.outCountDownNumber<=0&&(Laya.timer.clear(this,this.outCountDownEvent),this.goHome())}onHdDestroy(){var e;null===(e=this.guidHandAni)||void 0===e||e.destroy(),this.rewardShareIconAni(!1)}goFriendRewardView(){y.view.open(i.views.FriendsRewardView,{parm:{list:this.friendInviteData,call:()=>{}}})}friendShareGuide(e,t){return __awaiter(this,void 0,void 0,function*(){if(e){let e=yield H.inst.send({api:"/friend/invite/list",data:{}});t=e.list}if(this.friendInviteData=t,t.length<3)return void this.rewardShareIconAni(!0);let i=!1;for(let e=0;e<3;e++)if(!t[e].receivedReward){i=!0;break}this.rewardShareIconAni(i)})}rewardShareIconAni(e){var t;e?(this.rewardShareGuide.visible=!0,this.rewardShareGuideAnimation||(this.rewardShareGuideAnimation=Laya.TimeLine.to(this.rewardShareGuide,{rotation:15},150,null,5e3).to(this.rewardShareGuide,{rotation:-15},300,null).to(this.rewardShareGuide,{rotation:15},300,null).to(this.rewardShareGuide,{rotation:0},150,null)),this.rewardShareGuideAnimation.play(null,!0)):(null===(t=this.rewardShareGuideAnimation)||void 0===t||t.destroy(),this.rewardShareGuideAnimation=null,this.rewardShareGuide.visible=!1)}}__decorate([y.eventOn("plant_sow"),__metadata("design:type",Function),__metadata("design:paramtypes",[Boolean,Object]),__metadata("design:returntype",void 0)],P.prototype,"sow",null),__decorate([y.eventOn("open_friend"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],P.prototype,"openFriend",null),__decorate([y.eventOn("update_Order"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],P.prototype,"updateOrder",null),__decorate([y.eventOn("play_get_reward"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],P.prototype,"playGetRewardAni",null),__decorate([y.eventOn("play_ad_get_reward"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",void 0)],P.prototype,"playAdReward",null),__decorate([y.eventOn("update_task"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],P.prototype,"updateTask",null),__decorate([y.eventOn("go_home"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],P.prototype,"goHomeNodeData",null),__decorate([y.eventOn("go_friend_home"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",void 0)],P.prototype,"goFriendListen",null),__decorate([y.eventOn("update_friend_share_guide"),__metadata("design:type",Function),__metadata("design:paramtypes",[Boolean,Array]),__metadata("design:returntype",Promise)],P.prototype,"friendShareGuide",null);class E extends l{constructor(){super(...arguments),this.priceLabel=null,this.priceIcon=null,this.adBtn=null,this.buyBtn=null}onOpened(e){this.data=e;let t=C.table("config").get("vitalityBuyCostGold").value;this.costGoldCount=t,this.priceLabel.text=`价格：${t}`,this.adBtn.disabled=!I.advertiseTimes,this.adBtn.active=Boolean(I.advertiseTimes),5==P.inst.getGuideStep()&&Laya.timer.once(500,this,()=>{y.eventGlobal.event("update_guid",{nodeList:[this.adBtn],call:()=>{this.onClick({target:{name:"buyAdBtn"}}),Laya.timer.frameOnce(1,this,()=>{y.eventGlobal.event("update_guid_data",5),P.inst.guide()})},addPos:{x:100,y:120}})})}onClick(e){switch(e.target.name){case"closeAddLandLayer":y.view.close(i.views.BuyVitalityView);break;case"buyAdBtn":case"buyBtn":if(I.vitality>=C.table("config").get("vitalityLimit").value)return void y.view.openHint({text:"体力已满",call:()=>{}});if("buyBtn"==e.target.name&&I.gold<this.costGoldCount)return void y.view.openHint({text:"金币不足，去仓库出售蔬菜可以获得金币，偷菜获得的蔬菜也可以出售获得金币哦",call:()=>{}});H.inst.send({api:"/vitality/buy",data:{type:"buyBtn"==e.target.name?g.ApiTypeDefault:g.ApiTypeAD}}).then(e=>{var t;I.vitality=e.vitality,(null===(t=this.data)||void 0===t?void 0:t.call)&&this.data.call(),w.runAppFunction({uri:"eventCount",data:{type:"physicalstrength"}}),y.view.close(i.views.BuyVitalityView)})}}}class R extends l{constructor(){super(...arguments),this.priceLabel=null,this.priceIcon=null,this.lv=null,this.reward=null,this.probability=null,this.adBtn=null,this.cost=0}onOpened(e){this.data=e;let t=C.table("landLevel").get(e.obj.level+1);this.priceLabel.text=`价格：${t.cost.count}`,this.priceIcon.skin=t.cost.obj.icon,this.cost=t.cost.count,this.lv.text=`${e.obj.level+1}级`,this.reward.text=`+${Number((100*t.gain).toFixed(2))}%`,this.probability.text=`+${Number((100*t.probability).toFixed(2))}%`,this.adBtn.disabled=!I.advertiseTimes,this.adBtn.active=Boolean(I.advertiseTimes),(I.adTimes>100||I.continuousAdTimes>20)&&Laya.timer.once(300,this,()=>{w.runAppFunction({uri:"ad",data:{adType:2}}),w.runAppFunction({uri:"ad",data:{adType:3}}),w.runAppFunction({uri:"eventCount",data:{type:"half_screen_advertisement"}}),w.runAppFunction({uri:"eventCount",data:{type:"bottom_advertisement"}})})}onHdAwake(){(I.adTimes>100||I.continuousAdTimes>20)&&(this.owner.getChildByName("center").centerY=-310)}onClick(e){switch(e.target.name){case"closeAddLandLayer":y.view.close(i.views.FieldLevelUpView);break;case"upgradeBtn":case"upgradeAdBtn":if("upgradeBtn"==e.target.name&&this.cost>I.gold)return void y.view.openHint({text:"金币不足，去仓库出售蔬菜可以获得金币，偷菜获得的蔬菜也可以出售获得金币哦",call:()=>{}});H.inst.send({api:"/land/upgrade",data:{landId:this.data.obj.id,type:"upgradeBtn"==e.target.name?g.ApiTypeDefault:g.ApiTypeAD}}).then(t=>{"upgradeAdBtn"==e.target.name?y.eventGlobal.event("play_ad_get_reward",[e.target,t.adReward]):w.runAppFunction({uri:"eventCount",data:{type:"Landupgrading"}}),this.data.call&&this.data.call(),y.view.close(i.views.FieldLevelUpView)})}}onHdDestroy(){w.runAppFunction({uri:"closeImage",data:{}}),w.runAppFunction({uri:"closeAd",data:{}})}}class M extends y.gameScript{onOpened(e){this.call=null==e?void 0:e.call}onHdAwake(){this.panelNode.vScrollBarSkin=null}onClick(e){switch(e.target.name){case"close":y.view.close(i.views.FriendsDescView);break;case"invite_btn":y.view.close(i.views.FriendsDescView),this.call&&(this.call(),y.view.close(i.views.FriendsView))}}onHdDestroy(){Laya.loader.clearTextureRes("res/img_inviteBg1.png")}}var U=new class{get isBindWx(){return I.isBindWx||y.view.openHint({text:"提现需要绑定微信账号",call:()=>{this.bindWx()},cancelCall:()=>{}}),I.isBindWx}bindWx(){return __awaiter(this,void 0,void 0,function*(){const e={};console.log(e),e.code=0,e.data={message:"登录成功",name:"尊贵的VIP",iconurl:"https://thirdwx.qlogo.cn/mmopen/vi_32/mDGuJwZh6ibQRDVzBPIT8lQWoRtwKBchXTiahv7icKB9G7nUUee93O5PictDPjsvGxlvtvn0lk31yhUPibibZZR64m2w/132",openid:"oCA306E0ZIeME3T8wkUwS8gi8n2M"},console.log(typeof e.data.openid),e&&(e.code?y.view.openHint({text:`获取微信openid失败[${e.code}]，请重试`,call:()=>{this.bindWx()},cancelCall:()=>{}}):H.inst.send({api:"/user/bind",data:{openid:e.data.openid,avatar:e.data.iconurl,nickname:e.data.name}}).then(()=>{I.isBindWx=1,e.data.name&&(I.nickname=e.data.name),e.data.iconurl&&(I.avatar=e.data.iconurl),y.view.openHint({text:"绑定成功",call:()=>{}})}).catch(()=>{y.view.openHint({text:"绑定失败，是否重试？",call:()=>{this.bindWx()},cancelCall:()=>{}})}))})}};class $ extends y.gameScript{constructor(){super(...arguments),this.inviteList=[],this.rewardValue=0,this.proportion=0,this.canClick=!0}onHdAwake(){this.priceList.vScrollBarSkin=null,this.priceList.array=new Array(6),this.priceList.renderHandler=new Laya.Handler(this,this.renderItem)}onOpened(e){this.inviteList=e.list||[],this.call=e.call,I.invitePeople&&(this.inviteBox.visible=!1,this.inviteBox.active=!1),this.rewardValue=C.table("config").get("Invitation_rewards").value.count;const t=C.table("config").get("withdrawal").value;this.proportion=Number(t[1])}onClick(e){switch(e.target.name){case"close":y.view.close(i.views.FriendsRewardView);break;case"invite_btn":w.runAppFunction({uri:"wxShare",data:{},timestamp:Date.now()}).then(e=>{!e||(null==e?void 0:e.code)?y.view.openHint({text:e.data.message,call:()=>{}}):(y.view.openHint({text:e.data.message,call:()=>{}}),H.inst.send({api:"/friend/share"}).then(()=>{S.taskAddTimes(1010),w.runAppFunction({uri:"eventCount",data:{type:"share"}})}))});break;case"submit":this.submit();break;case"btn":const t=e.target.dataSource;this.withdraw(t)}}withdraw(e){this.canClick&&U.isBindWx&&(this.canClick=!1,H.inst.send({api:"/friend/invite/receive",data:{index:e}}).then(()=>{this.canClick=!0,y.view.openHint({text:"提现成功",call:()=>{}}),this.inviteList[e].receivedReward=1,this.priceList.refresh(),y.eventGlobal.event("update_friend_share_guide",[this.inviteList])}).catch(()=>{this.canClick=!0}))}renderItem(e,t){e.getChildByName("top").text=`第${t+1}位`;const i=e.getChildByName("btn");e.getChildByName("price_box").getChildByName("price").text=`${this.rewardValue/this.proportion}`,i.skin="game/img_extractActive.png",this.inviteList.length>t?this.inviteList[t].receivedReward?(i.disabled=!0,i.skin="game/img_cashDone.png"):i.disabled=!1:i.disabled=!0,t>2&&(i.disabled=!1,i.visible=!1),i.dataSource=t}submit(){this.inviteInput.text&&this.inviteInput.text.length?this.canClick&&(this.canClick=!1,H.inst.send({api:"/friend/invite/people",data:{key:this.inviteInput.text}}).then(()=>{I.invitePeople=this.inviteInput.text,y.view.openHint({text:"绑定成功",call:()=>{}}),this.inviteBox.visible=!1,this.inviteBox.active=!1,this.canClick=!0,this.call&&this.call()}).catch(()=>{this.canClick=!0})):y.view.openHint({text:"邀请码不能为空！",call:()=>{}})}onHdDestroy(){}}class j extends y.gameScript{constructor(){super(...arguments),this.empty_lb=null,this.viewState=1,this.friends=[],this.friendsList=[],this.canClick=!0}onOpened(e){this.friends=e.friendData.list,this.friendsList=this.friends,this.updateListData(),this.addBox.visible=!1,this.addBox.active=!1,this.itemList.array=this.friendsList,this.isEmpty(),this.itemList.renderHandler=new Laya.Handler(this,this.itemRender),this.itemList.vScrollBarSkin=null,this.userKey.text=`我的友情码：${I.key}`,e.type&&1==e.type&&this.addFriendEvent();let t=Laya.TimeLine.to(this.rewardBtn,{scaleX:1.2,scaleY:1.2,y:10},1e3,Laya.Ease.bounceOut).to(this.rewardBtn,{scaleX:1,scaleY:1,y:19},300);t.play(null,!0),this.rewardBtnAni=t}isEmpty(){this.empty_lb.visible=!this.itemList.array.length}updateListData(){this.friendsList.sort((e,t)=>1e5*t.applyIng-1e5*e.applyIng)}itemRender(e,t){const i=this.itemList.array[t];let a=e.getChildByName("new_box"),s=e.getChildByName("heart_box"),n=e.getChildByName("go_play_btn"),o=e.getChildByName("apply_btn"),d=e.getChildByName("del_btn");switch(s.visible=!1,n.visible=!1,o.visible=!1,d.visible=!1,(null==i?void 0:i.avatar)&&(e.getChildByName("head").skin=i.avatar),e.getChildByName("name").text=i.nickname,e.getChildByName("lv").text=(i.orderLevel||0)+"",s.getChildByName("val").text=(i.intimacy||0)+"",e.getChildByName("reward_box").getChildByName("value").text=i.gainDiamond+"",e.getChildByName("del_btn").dataSource=i,n.dataSource=i,this.viewState){case 1:n.visible=!0,s.visible=!0;break;case 2:o.dataSource=i,o.visible=!0,a.visible=!1,a.active=!1;break;case 3:s.visible=!0,d.visible=!0}1!=this.viewState&&3!=this.viewState||(i.applyIng?(a.visible=!0,a.active=!0,a.getChildByName("past_btn").dataSource=i,a.getChildByName("ignore").dataSource=i,s.visible=!1,n.visible=!1):(a.visible=!1,a.active=!1))}onClick(e){if(this.canClick)switch(console.log(e.target.name),e.target.name){case"close":y.view.close(i.views.FriendsView);break;case"add_friend":this.addFriendEvent();break;case"del_friend":this.deleteFriendEvent();break;case"desc_btn":y.view.open(i.views.FriendsDescView,{parm:{call:()=>{this.openReward()}}});break;case"reward_btn":this.openReward();break;case"copy_btn":this.copy();break;case"search_btn":this.search();break;case"apply_btn":this.applyEvent(e.target);break;case"past_btn":this.allowFriend(e.target);break;case"del_btn":this.deleteFriend(e.target);break;case"ignore":this.ignore(e.target);break;case"go_play_btn":this.visitFriend(e.target)}}deleteFriendEvent(){if(3==this.viewState)return;this.addBox.visible=!1,this.addBox.active=!1,this.viewState=3;let e=[];this.friends.forEach(t=>{t.applyIng||e.push(t)}),this.itemList.array=e,this.itemList.height=914,this.itemList.refresh(),this.isEmpty(),this.addFriend.skin="game/img_friendBtn.png"}addFriendEvent(){3==this.viewState||2==this.viewState?(console.log(this.viewState),this.viewState=1,this.itemList.array=this.friends,this.itemList.height=914,this.addFriend.skin="game/img_addBtn.png",this.addBox.visible=!1,this.addBox.active=!1,this.isEmpty()):(this.viewState=2,this.addBox.visible=!0,this.addBox.active=!0,this.itemList.array=[],this.itemList.height=590,this.addFriend.skin="game/img_friendBtn.png",this.empty_lb.visible=!1),this.itemList.refresh()}ignore(e){let t=e.dataSource;this.canClick=!1,H.inst.send({api:"/friend/delete",data:{friendId:t.uid}}).then(e=>{for(let e=0;e<this.friends.length;e++)if(this.friends[e].uid==t.uid){this.friends.splice(e,1);break}this.canClick=!0,this.itemList.refresh(),this.isEmpty(),V.updateMsg()}).catch(()=>{this.canClick=!0})}openReward(){this.canClick=!1,H.inst.send({api:"/friend/invite/list",data:{}}).then(e=>{y.view.open(i.views.FriendsRewardView,{parm:{list:e.list,call:()=>{H.inst.send({api:"/friend/list"}).then(e=>{this.friends=e.list,this.friendsList=this.friends,this.updateListData(),this.itemList.array=this.friendsList,this.isEmpty(),this.itemList.refresh()})}}}),this.canClick=!0}).catch(()=>{this.canClick=!0})}visitFriend(e){this.canClick=!1,y.view.setOverView(!0,()=>__awaiter(this,void 0,void 0,function*(){let t=e.dataSource;P.inst.isOuter&&(yield H.inst.send({api:"/goHome",data:{}})),H.inst.send({api:"/friend/visit",data:{friendId:t.uid}}).then(e=>{y.view.close(i.views.FriendsView),y.eventGlobal.event("go_friend_home",[e,t]),setTimeout(()=>{y.view.setOverView(!1),this.canClick=!0},300)}).catch(()=>{this.canClick=!0,y.eventGlobal.event("go_home",[!0])})}))}deleteFriend(e){y.view.openHint({text:"确认要删除好友吗？",call:()=>{let t=e.dataSource;H.inst.send({api:"/friend/delete",data:{friendId:t.uid}}).then(e=>{for(let e=0;e<this.friends.length;e++)if(this.friends[e].uid==t.uid){this.friends.splice(e,1);break}this.itemList.array=this.friendsList,this.itemList.refresh(),this.isEmpty()})},cancelCall:()=>{}})}allowFriend(e){this.canClick=!1;let t=e.dataSource;H.inst.send({api:"/friend/allow",data:{friendId:t.uid}}).then(()=>{t.applyIng=0,this.itemList.refresh(),this.canClick=!0,w.runAppFunction({uri:"eventCount",data:{type:"Addfriends"}}),V.updateMsg()}).catch(()=>{this.canClick=!0})}applyEvent(e){let t=e.dataSource;this.canClick=!1,H.inst.send({api:"/friend/apply",data:{friendId:t.uid}}).then(e=>{this.friendsList=[],this.itemList.array=this.friendsList,this.itemList.refresh(),y.view.openHint({text:"已发送激情",call:()=>{}}),this.canClick=!0,e.taskState&&S.taskAddTimes(1009)}).catch(()=>{this.canClick=!0})}search(){this.keyInputNode.text.length?this.keyInputNode.text!=I.key?(this.canClick=!1,H.inst.send({api:"/friend/search",data:{key:this.keyInputNode.text}}).then(e=>{this.friendsList=[e],this.itemList.array=this.friendsList,this.itemList.refresh(),this.canClick=!0}).catch(()=>{this.canClick=!0})):y.view.openHint({text:"搜索自己干啥",call:()=>{}}):y.view.openHint({text:"友情码不能为空",call:()=>{}})}copy(){let e=document.createElement("input");document.body.appendChild(e),e.value=I.key,e.select(),document.execCommand("copy"),e.remove(),y.view.openHint({text:"复制成功",call:()=>{}})}onHdDestroy(){this.rewardBtnAni.destroy()}}class W extends y.gameScript{constructor(){super(...arguments),this.canClick=!0}onOpened(e){var t;switch(this.stealGet.visible=!1,this.order.visible=!1,this.data=e,this.stealGet.vScrollBarSkin=null,this.order.vScrollBarSkin=null,this.adBtn.disabled=!I.advertiseTimes,this.adBtn.active=Boolean(I.advertiseTimes),Laya.timer.once(300,this,()=>{w.runAppFunction({uri:"ad",data:{adType:3}}),w.runAppFunction({uri:"ad",data:{adType:2}}),w.runAppFunction({uri:"eventCount",data:{type:"half_screen_advertisement"}}),w.runAppFunction({uri:"eventCount",data:{type:"bottom_advertisement"}})}),e.type){case 1:this.order.visible=!0,this.order.getChildByName("desc").getChildByName("lb2").text=`${I.orderLevel+1}`,this.order.getChildByName("price_box").getChildAt(0).getChildByName("icon").skin=C.table("currency").get(g.goldId).icon,this.order.getChildByName("price_box").getChildAt(0).getChildByName("lb").text="x"+e.data.gold,this.order.getChildByName("price_box").getChildAt(1).getChildByName("lb").text="x"+e.data.diamond,this.order.getChildByName("price_box").getChildAt(1).getChildByName("icon").skin=C.table("currency").get(g.diamondId).icon;break;case 2:this.stealGet.visible=!0,this.stealGet.getChildByName("title").text="偷菜成功",this.stealGet.getChildByName("top_lb").text=`你潜入了${(null===(t=this.data)||void 0===t?void 0:t.nickname)||""}...的菜地，偷走了：`,this.updateDescList();break;case 3:this.stealGet.visible=!0,this.stealGet.getChildByName("title").text="农作物成熟",this.stealGet.getChildByName("top_lb").text="通过您辛勤劳作，收获了：",this.updateDescList()}}updateDescList(){var e;let t=this.data.data,i=0,a=0;for(let e=0;e<t.length;e++){let s=this.item.create();i>3&&(a+=1,i=0),s.x=28+190*i,s.y=203+95*a;let n=C.table("plant").get(t[e].plantId);const o=s.getChildByName("icon");o.skin=n.icon,o.scale(.7,.7),o.anchorX=.5,s.getChildByName("lb").text=`x${t[e].amount}`,this.stealGet.addChild(s),i++}let s=this.stealGet.getChildByName("bottom_lb");s.y+=95*a,s.getChildByName("diamond").getChildByName("icon").skin=C.table("currency").get(g.diamondId).icon,s.getChildByName("diamond").getChildByName("lb").text=`x${(null===(e=this.data)||void 0===e?void 0:e.diamond)||0}`}onClick(e){switch(e.target.name){case"close":y.view.close(i.views.GatherDescView),1!=this.data.type&&this.data.call&&this.data.call(!1);break;case"receive":case"receive_double":if(!this.canClick)return;this.canClick=!1,1==this.data.type?H.inst.send({api:"/order/reward",data:{orderId:I.orderLevel+1,type:"receive"==e.target.name?g.ApiTypeDefault:g.ApiTypeAD}}).then(()=>{y.view.close(i.views.GatherDescView),this.canClick=!0,this.data.call&&this.data.call("receive"!=e.target.name)}).catch(()=>{this.canClick=!0,w.runAppFunction({uri:"closeAd",data:{}})}):"receive_double"==e.target.name?2==this.data.type?this.data.call(!0,e.target):H.inst.send({api:"/land/gather",data:{landId:[],type:g.ApiTypeAD}}).then(t=>{this.data.call&&(this.data.call(!0),t.adReward.forEach((e,t)=>{this.data.diamond&&e.id==g.diamondId&&(e.amount+=2*this.data.diamond)}),y.eventGlobal.event("play_ad_get_reward",[e.target,t.adReward])),y.view.close(i.views.GatherDescView)}).catch(()=>{w.runAppFunction({uri:"closeAd",data:{}}),this.canClick=!0}):(this.data.call&&this.data.call(!1),y.view.close(i.views.GatherDescView))}}onHdDestroy(){w.runAppFunction({uri:"closeAd",data:{}}),this.data.closeEvent&&this.data.closeEvent(),2==this.data.type&&y.eventGlobal.event("update_Order")}}class J extends y.gameScript{onOpened(e){var t;this.data=e,this.text.text=(null===(t=this.data)||void 0===t?void 0:t.text)||"",this.data.call?this.confirmBtn.visible=!0:this.confirmBtn.visible=!1,this.data.cancelCall?this.cancelBtn.visible=!0:this.cancelBtn.visible=!1,this.data.call&&this.data.cancelCall?this.confirmBtn.x=252:this.confirmBtn.x=458,(I.adTimes>100||I.continuousAdTimes>20)&&Laya.timer.once(300,this,()=>{w.runAppFunction({uri:"ad",data:{adType:2}}),w.runAppFunction({uri:"ad",data:{adType:3}}),w.runAppFunction({uri:"eventCount",data:{type:"half_screen_advertisement"}}),w.runAppFunction({uri:"eventCount",data:{type:"bottom_advertisement"}})})}onHdAwake(){(I.adTimes>100||I.continuousAdTimes>20)&&(this.owner.getChildByName("center").centerY=-310)}onClick(e){var t,a;switch(e.target.name){case"cancel":(null===(t=this.data)||void 0===t?void 0:t.cancelCall)&&this.data.cancelCall(),y.view.close(i.views.HintView);break;case"confirm":(null===(a=this.data)||void 0===a?void 0:a.call)&&this.data.call(),y.view.close(i.views.HintView)}}onHdDestroy(){w.runAppFunction({uri:"closeAd",data:{}})}}class X extends l{constructor(){super(...arguments),this.loadBar=null,this.loadBox=null,this.loginBox=null,this.appleBtn=null,this.privacyBox=null,this.privacyCheckIcon=null,this.loadBarOldWidth=0,this.canClick=!0}onOpened(e){var t;return __awaiter(this,void 0,void 0,function*(){this.data=e,this.setLoginBtnState(!1),this.loadBox.visible=!1,this.privacyBox.visible=!1,Laya.Browser.onIOS||(yield this.version()),(null===(t=f.getJSON())||void 0===t?void 0:t.isLogin)?(this.login(!1),this.loadBox.visible=!0):(this.setLoginBtnState(!0),this.loadBox.visible=!1,this.privacyBox.visible=!0)})}onHdAwake(){a.on("load_progress",this,this.loadProgress)}onHdEnable(){this.loadBarOldWidth=this.loadBar.width,this.loadBar.width=0}setLoginBtnState(e){e?Laya.Browser.onIOS?(this.appleBtn.visible=!0,w.runAppFunction({uri:"installWechat",data:{},timestamp:Date.now()}).then(e=>{e.code||(this.loginBox.visible=!0,this.loginBox.y=769)})):this.loginBox.visible=!0:(this.loginBox.visible=!1,this.appleBtn.visible=!1)}getBuildType(){let e=null;switch(BUILD_TYPE){case"debug":e=3;break;case"test":e=2;break;case"online":e=1}return e||y.view.openHint({text:"环境type配置出错",call:()=>{w.runAppFunction({uri:"clearCache",data:{}}),location.reload()}})}version(){return __awaiter(this,void 0,void 0,function*(){return new Promise(e=>{H.inst.send({api:"/config/client",data:{id:this.getBuildType()}}).then(t=>{var i;const a=Number(null===(i=f.getJSON().version)||void 0===i?void 0:i.replace(/\./g,""));if(!a)return e(null),f.setJSON("version",t.version),void(g.version=t.version);Number(t.version.replace(/\./g,""))>a?(w.runAppFunction({uri:"clearCache",data:{}}),y.view.openHint({text:"检测到新的版本，请更新！",call:()=>{f.setJSON("version",t.version),w.runAppFunction({uri:"showBackground",data:{}}),location.reload()}})):(g.version=t.version,f.setJSON("version",t.version),e(null))}).catch(()=>{alert("版本检测出错"),e(null)})})})}onClick(e){switch(e.target.name){case"login_btn":this.login(!0);case"apple_btn":this.login(!1);break;case"check_box":this.privacyCheckIcon.visible=!this.privacyCheckIcon.visible;break;case"privacy_lb":w.runAppFunction({uri:"privacyAgreement",data:{}})}}login(e){return __awaiter(this,void 0,void 0,function*(){if(this.canClick)if(this.canClick=!1,Laya.timer.once(1e3,this,()=>{this.canClick=!0}),f.getJSON().token)H.inst.send({api:"/login/token",error:(e,t)=>{f.clear(),this.setLoginBtnState(!0),this.loadBox.visible=!1}}).then(e=>{var t;(null===(t=this.data)||void 0===t?void 0:t.call)&&this.data.call(e),this.setLoginBtnState(!1),this.loadBox.visible=!0,this.canClick=!0,w.runAppFunction({uri:"LoginSuccess",data:{user_id:Number(e.userInfo.key)},timestamp:Date.now()}).then(e=>{(null==e?void 0:e.code)?y.view.openHint({text:`登录失败[${e.code}]`}):e&&(g.channel=e.data.channel)}),w.runAppFunction({uri:"eventCount",data:{type:"Signin"}})}).catch(()=>{this.canClick=!0,this.setLoginBtnState(!0),this.loadBox.visible=!1,this.privacyBox.visible=!0}),this.privacyBox.visible=!1;else{if(this.privacyBox.visible=!0,!this.privacyCheckIcon.visible)return void y.view.openHint({text:"请阅读《用户隐私协议》",call:()=>{f.clear(),this.setLoginBtnState(!0),this.canClick=!0,this.loadBox.visible=!1}});let t=location.search.match(/\?id=(.+)/),i=null;t&&t.length>1&&"online"!=BUILD_TYPE&&(i=t[1]);let a=i,s="",n="",o={account:a,avatar:n,nickname:s};if(e){if(!a){const e=yield w.runAppFunction({uri:"wxLogin",data:{},timestamp:Date.now()});e&&(e.code?y.view.openHint({text:`微信登录失败[${e.code}]，请重试`,call:()=>{location.reload()}}):(a=e.data.openid,n=e.data.iconurl,s=e.data.name)),o={wxId:a,avatar:n,nickname:s}}}else{if(Laya.Browser.onIOS){const e=yield w.runAppFunction({uri:"appleLogin",data:{},timestamp:Date.now()});e&&(e.code?y.view.openHint({text:`苹果登录失败[${e.code}]，请重试`,call:()=>{location.reload()}}):a=e.data.openid)}o={account:a,avatar:n,nickname:s}}if(!a)return void y.view.openHint({text:"未获取到账号id",call:()=>{this.canClick=!0}});this.privacyBox.visible=!1,H.inst.send({api:"/login",data:o,error:(e,t)=>{f.clear(),this.setLoginBtnState(!0),this.loadBox.visible=!1,this.canClick=!0}}).then(e=>{var t;(null===(t=this.data)||void 0===t?void 0:t.call)&&this.data.call(e),this.setLoginBtnState(!1),this.loadBox.visible=!0,this.canClick=!0,I.isFirstTime||w.runAppFunction({uri:"registerSuccess",data:{user_id:Number(e.userInfo.key)}}),w.runAppFunction({uri:"LoginSuccess",data:{user_id:Number(e.userInfo.key)},timestamp:Date.now()}).then(e=>{e&&(e.code?y.view.openHint({text:`登录失败[${e.code}]`,call:()=>{location.reload()}}):g.channel=e.data.channel)}),w.runAppFunction({uri:"eventCount",data:{type:"Signin"}})}).catch(()=>{this.canClick=!0})}})}loadProgress(e){this.loadBar.width=e*this.loadBarOldWidth}onHdDisable(){a.off("load_progress",this,this.loadProgress)}}class Y extends y.gameScript{constructor(){super(...arguments),this.mailId=null}onOpened(e){const t=e.data;this.call=e.call,this.mailId=e.data.id,this.centerPanel.vScrollBarSkin=null,this.title.text=`${t.message}潜入了你的菜地偷菜`,console.log(e);const i=[],a=[];let s=0,n=0;k.parseString(t.itemsLost).map(e=>{if(e=k.parseString(e,":"),console.log(e),1==e[0])return void(s+=Number(e[2]));let t=!1;if(i.forEach(i=>{i.id==e[1]&&(t=!0)}),t){for(let t=0;t<i.length;t++)if(i[t].id==e[1]){i[t].amount+=Number(e[2]);break}}else i.push({id:e[1],amount:Number(e[2])})}),k.parseString(t.items).map(e=>{e=k.parseString(e,":");let t=!1;if(a.forEach(i=>{i.id==e[1]&&(t=!0)}),t){for(let t=0;t<a.length;t++)if(a[t].id==e[1]){a[t].amount+=Number(e[2]);break}}else a.push({id:e[1],amount:Number(e[2])})});let o=0,d=0;for(let e=0;e<i.length;e++){let t=this.item.create();d>2&&!o&&(o++,d=-1),o&&d>2&&(o++,d=-1),t.x=230+190*d,t.y=105+95*o,d++;let a=C.table("plant").get(i[e].id);const s=t.getChildByName("icon");s.skin=a.icon,s.scale(.7,.7),s.anchorX=.5,t.getChildByName("lb").text=`x${i[e].amount}`,a.gain.forEach(t=>{t.obj.id!=g.diamondId&&(n+=t.count*i[e].amount)}),this.centerPanel.addChild(t)}let l=0;d=0;for(let e=0;e<a.length;e++){let t=this.item.create();d>1&&!l&&(l++,d=-2),l&&d>1&&(l++,d=-2),t.x=420+190*d,t.y=208+95*o+95*l,d++;let i=C.table("plant").get(a[e].id);const s=t.getChildByName("icon");s.skin=i.icon,s.scale(.7,.7),s.anchorX=.5,t.getChildByName("lb").text=`x${a[e].amount}`,this.centerPanel.addChild(t)}this.lostLb.y=114,this.backLb.y=218+95*o,this.bottomLb.y=301+95*o+95*l,this.bottomLb.text=`共计损失了${n}金币，${s}钻石`}onClick(e){switch(e.target.name){case"close":y.view.close(i.views.MailDescView);break;case"delete":H.inst.send({api:"/mail/delete",data:{id:this.mailId}}).then(()=>{this.call&&this.call(this.mailId),Laya.timer.frameOnce(1,this,()=>{y.view.close(i.views.MailDescView)})})}}}class z extends l{constructor(){super(...arguments),this.list=null,this.empty_lb=null,this.listData=[]}onHdAwake(){this.list.vScrollBarSkin=null,this.list.renderHandler=new Laya.Handler(this,this.renderItem)}onOpened(e=[]){this.listData=e,this.updateListData()}updateListData(){this.list.array=this.listData.sort((e,t)=>t.createTime-(t.read?1e6:0)-(e.createTime-(e.read?1e6:0))),this.empty_lb.visible=!this.list.array.length}renderItem(e,t){const i=this.listData[t];e.getChildByName("title").text="系统邮件",e.getChildByName("desc").text=`${i.message}潜入菜地偷菜,被狗狗发现并追加回了~~`,e.getChildByName("time").text=`${new Date(i.createTime).toLocaleString("zh-CN",{hour12:!1})}`,e.getChildByName("read_icon").visible=!i.read,e.dataSource=i}onClick(e){switch(e.target.name.indexOf("item")>-1&&H.inst.send({api:"/mail/read",data:{id:e.target.dataSource.id}}).then(()=>{e.target.dataSource.read=1,this.list.refresh(),V.updateMsg(),y.view.open(i.views.MailDescView,{parm:{data:e.target.dataSource,call:e=>{for(let t=0;t<this.listData.length;t++)if(this.listData[t].id==e){this.listData.splice(t,1);break}this.list.refresh()}}})}),e.target.name){case"close":p.inst.close(i.views.MailView)}}}class q extends Laya.Script{constructor(){super(),this._x="0",this._y="0",this.delay="0",this.time="10000"}onEnable(){let e=this.owner;e.alpha=0;let t={x:e.x,y:e.y},i=Number(this.delay);Laya.Tween.to(e,{alpha:1},600,null,null,i),Laya.Tween.to(e,{x:this._x,y:this._y},Number(this.time),null,Laya.Handler.create(this,()=>{e.pos(t.x,t.y),this.onEnable()}),i)}onDisable(){}}class K extends y.gameScript{onHdAwake(){let e=this.owner;e.visible=!1,e.anchorX=.5,e.anchorY=.5}updateRedDot(e,t){if(this.redDotType==e){let e=this.owner;t?(e.visible||(e.scale(0,0),e.y-=40,Laya.Tween.clearAll(e),Laya.Tween.to(e,{scaleX:1,scaleY:1},300,Laya.Ease.backOut,new Laya.Handler(this,()=>{Laya.Tween.to(e,{y:e.y+40},300,Laya.Ease.backOut,null,200)}))),e.visible=t):e.visible&&Laya.Tween.to(e,{scaleX:0,scaleY:0},300,Laya.Ease.backIn,new Laya.Handler(this,()=>{e.visible=t}))}}}__decorate([y.eventOn("update_red_dot"),__metadata("design:type",Function),__metadata("design:paramtypes",[String,Boolean]),__metadata("design:returntype",void 0)],K.prototype,"updateRedDot",null);class Q extends y.gameScript{constructor(){super(...arguments),this.guideHand=null,this.descLb=null,this.nodeBox=null,this.bg=null,this.hintLb=null,this.canClick=!0}onHdAwake(){this.updateState(!1),this.guidHandAni()}updateStep(e){if(!e)return;this.data=e,this.updateState(!0),e.addPos||(e.addPos={x:0,y:0});const t=this.data.nodeList[0];this.oldZOrder=t.zOrder,this.oldParent=t.parent;const i=this.nodeBox.globalToLocal(this.oldParent.localToGlobal(new Laya.Point(t.x,t.y)));t.once(Laya.Event.CLICK,this,()=>__awaiter(this,void 0,void 0,function*(){null!=e.step&&(yield this.updateGuidData(e.step)),e.call&&e.call(),this.hintLb.visible=!1,Laya.timer.once(1,this,(t,i)=>{if(t&&i)if(i.destroyed)t.destroy();else{const e=i.globalToLocal(this.nodeBox.localToGlobal(new Laya.Point(t.x,t.y)));i.addChild(t),t.zOrder=0,t.updateZOrder(),t.pos(e.x,e.y)}switch(e.step){case 0:case 2:P.inst.guide()}},[t,this.oldParent])})),this.nodeBox.addChild(t),t.pos(i.x,i.y),Laya.Tween.to(this.guideHand,{x:i.x+e.addPos.x,y:i.y+e.addPos.y,alpha:1},300),e.text?(this.hintLb.visible=!0,this.hintLb.text=e.text,this.hintLb.alpha=0,this.hintLb.pos(i.x+e.testAddPos.x,i.y+e.testAddPos.y),Laya.timer.once(300,this,()=>{Laya.Tween.to(this.hintLb,{x:i.x+e.testAddPos.x+50,y:i.y+e.testAddPos.y,alpha:1},300)})):this.hintLb.visible=!1}updateGuidData(e){return I.guideData[e]="1",H.inst.send({api:"/guide",data:{data:I.guideData.join("")}}).then(()=>{this.canClick=!0}).catch(()=>{this.canClick=!0})}updateState(e){let t=this.owner;t.visible=e,t.disabled=!e,t.active=e}guidHandAni(){this.guidAni=Laya.TimeLine.to(this.guideHand,{rotation:-15},400,null).to(this.guideHand,{rotation:0},400),this.guidAni.play(null,!0)}onHdDestroy(){var e,t;null===(e=this.guidAni)||void 0===e||e.pause(),null===(t=this.guidAni)||void 0===t||t.destroy()}}__decorate([y.eventOn("update_guid"),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],Q.prototype,"updateStep",null),__decorate([y.eventOn("update_guid_data"),__metadata("design:type",Function),__metadata("design:paramtypes",[Number]),__metadata("design:returntype",void 0)],Q.prototype,"updateGuidData",null);class Z extends y.gameScript{constructor(){super(...arguments),this.orderList=null,this.btnLockRes=null,this.btnResCur=null,this.topDesc=null}onOpened(){this.dataList=C.table("order").list;let e=I.orderLevel||0;this.dataList.sort((t,i)=>t.id+(t.id<=e?2e3:0)-(i.id+(i.id<=e?2e3:0))),this.orderList.array=this.dataList,this.orderList.renderHandler=new Laya.Handler(this,this.renderList),this.orderList.vScrollBarSkin=null;let t=0;for(let e=0;e<this.dataList.length;e++){let i=0;this.dataList[e].condition.forEach(e=>{e.plant.gain.forEach(t=>{t.obj.id===g.diamondId&&(i+=t.count*e.count)})}),t+=this.dataList[e].extraReward.count+i+Math.round(i*this.dataList[e].commission)}C.table("config").get("withdrawal").value;this.topDesc.getChildAt(0).text="完成所有订单可获得",this.topDesc.getChildAt(1).text=`${t}`}renderList(e,t){var i;let a,s=this.dataList[t],n=0,o=0,d=0,l=0,r=0,c=e.getChildByName("reward_box"),h=e.getChildByName("order_lv");h.text=`${s.id}级订单`;for(let t=0;t<4;t++){let c=e.getChildByName("item_"+t);s.condition[t]?((d=(null===(i=N.getOne(s.condition[t].plant.id))||void 0===i?void 0:i.count)||0)>=(l=s.condition[t].count)&&r++,c.getChildByName("icon").skin=s.condition[t].plant.icon,s.id<I.orderLevel+1?(c.getChildByName("num").text=`${l}/${l}`,c.getChildByName("bar").width=87):(c.getChildByName("num").text=`${d}/${l}`,c.getChildByName("bar").width=87*(d/l>1?1:d/l)),c.visible=!0,s.condition[t].plant.gain.forEach(e=>{e.obj.id===g.goldId?(a||(a=e),n+=e.count*s.condition[t].count):o+=e.count*s.condition[t].count})):c.visible=!1}let u=e.getChildByName("reward_box_diamond"),p=e.getChildByName("btn"),m=e.getChildByName("finish"),v=e.getChildByName("cur_icon"),w=e.getChildByName("receive_btn"),y=e.getChildByName("lv_box");m.visible=!1,v.visible=!1,u.visible=!1,p.visible=!0,c.y=57,c.visible=!0,y.visible=!0,h.visible=!0,w.visible=!1,s.id>I.orderLevel+1?(p.skin=this.btnLockRes,p.active=!1,s.extraReward?(p.visible=!1,u.getChildByName("icon").skin=s.extraReward.obj.icon,u.getChildByName("value").text=`+${s.extraReward.count+o+Math.floor(o*s.commission)}`,u.visible=!0):p.visible=!0):s.id==I.orderLevel+1?(s.extraReward?(v.visible=!0,y.visible=!1,p.visible=!1,h.visible=!1,u.getChildByName("icon").skin=s.extraReward.obj.icon,u.getChildByName("value").text=`+${s.extraReward.count+o+Math.floor(o*s.commission)}`,u.visible=!0):p.skin=this.btnResCur,r==s.condition.length&&(w.visible=!0,c.visible=!1,u.visible=!1)):(console.log("已完成"),p.active=!1,p.visible=!1,m.visible=!0,s.extraReward?c.y=57:c.y=100),a&&(c.getChildByName("icon").skin=a.obj.icon,c.getChildByName("value").text=`+${Math.floor(n*(1+s.commission))}`)}onClick(e){switch(e.target.name){case"close":y.view.close(i.views.OrderView);break;case"receive_btn":P.inst.hindOrderLevel=0,y.eventGlobal.event("update_Order"),y.view.close(i.views.OrderView)}}}class ee extends y.gameScript{onHdEnable(){}onOpened(e){(null==e?void 0:e.call)&&e.call(this)}close(e){this.leftBox.x=-987,this.rightBox.x=1025,this.leftBox.alpha=0,this.rightBox.alpha=0,Laya.Tween.to(this.leftBox,{x:0,alpha:1},500),Laya.Tween.to(this.rightBox,{x:0,alpha:1},500,null,Laya.Handler.create(this,()=>{e&&e()}))}open(e){Laya.Tween.to(this.leftBox,{x:-987,alpha:0},500),Laya.Tween.to(this.rightBox,{x:1025,alpha:0},500,null,Laya.Handler.create(this,()=>{e&&e(),y.view.close(i.views.OverView)}))}}class te extends y.gameScript{constructor(){super(...arguments),this.musicNode=null,this.soundNode=null,this.avatarNode=null,this.nickname=null}onOpened(){this.musicChange(),this.soundChange(),Laya.timer.once(300,this,()=>{w.runAppFunction({uri:"ad",data:{adType:3}})}),w.runAppFunction({uri:"eventCount",data:{type:"bottom_advertisement"}}),this.userKey.text=`邀请码：${I.key}`,y.observableProperty.watch(I,this).key("avatar",e=>{e&&(this.avatarNode.skin=e)}).key("nickname",e=>{this.nickname.text=e})}onClick(e){switch(console.log(e.target.name),e.target.name){case"close":y.view.close(i.views.SettingView);break;case"music":y.audio.playSound(i.audios.button_click),y.audio.musicMuted=!y.audio.musicMuted,f.setJSON("music",y.audio.musicMuted),this.musicChange();break;case"sound":y.audio.playSound(i.audios.button_click),y.audio.soundMuted=!y.audio.soundMuted,f.setJSON("sound",y.audio.soundMuted),this.soundChange();break;case"sign_out":y.view.openHint({text:"确认要退出登录？",call:()=>{f.setJSON("isLogin",!1),f.setJSON("token",null),O.loginOut(),Laya.timer.frameOnce(1,this,()=>{y.view.loginOut(),y.view.open(i.views.LoginView,{parm:{call:()=>{y.eventGlobal.event("login_game")}}})})},cancelCall:()=>{}});break;case"user_agreement":w.runAppFunction({uri:"serviceAgreement",data:{}});break;case"privacy":w.runAppFunction({uri:"privacyAgreement",data:{}});break;case"about":y.view.open(i.views.AboutView);break;case"copy_btn":this.copy()}}copy(){let e=document.createElement("input");document.body.appendChild(e),e.value=I.key,e.select(),document.execCommand("copy"),e.remove(),y.view.openHint({text:"复制成功",call:()=>{}})}musicChange(){const e=this.musicNode.getChildByName("box"),t=e.getChildByName("icon");let i=y.audio.musicMuted;console.log(i),t.x=i?91:-14,t.skin=i?"game/img_musicOffBtn.png":"game/img_musicOnBtn.png",e.skin=i?"game/img_swithOff.png":"game/img_switchOn.png"}soundChange(){const e=this.soundNode.getChildByName("box"),t=e.getChildByName("icon");let i=y.audio.soundMuted;t.x=i?91:-14,t.skin=i?"game/img_musicOffBtn.png":"game/img_musicOnBtn.png",e.skin=i?"game/img_swithOff.png":"game/img_switchOn.png"}onHdDestroy(){w.runAppFunction({uri:"closeAd",data:{}})}}var ie=new class{constructor(){this.list=[]}init(){C.table("feed").list.forEach(e=>{this.list.push({base:e,lock:!1})})}clear(){this.list.length=0}};class ae extends l{constructor(){super(...arguments),this.itemList=null,this.btnBoxTop=null,this.bottomBox=null,this.seedDesc=null,this.matureTime=null,this.matureGainBox=null,this.lockBtnBox=null,this.itemBuyBtn=null,this.feedBuyBtn=null,this.feedDesc=null,this.petIcon=null,this.petDesc=null,this.petName=null,this.vitalityMax=null,this.petBuyBtn=null,this.goWatch=null,this.goRest=null,this.diamondFont=null,this.priceList=null,this.proportion=null,this.descPriceBox=null,this.conditionBox=null,this.priceDataList=[],this.priceSelectIndex=null,this.inviteNum=0,this.btnTopResList=[["game/img_seedsNormal.png","game/img_seedsSelected.png"],["game/img_petNormal.png","game/img_petSelected.png"],["game/img_foodnNormal.png","game/img_foodnSelected.png"],["game/img_bankNormal.png","game/img_bankSelected.png"]],this.topBtnSelectIndex=0,this.itemListSelectIndex=0,this.itemSelectBg=["game/img_petbagNormal.png","game/img_petbagSelected.png"],this.selectPetIndex=0,this.isFirst=!0,this.canPrice=!0,this.canClick=!0}onHdAwake(){this.itemList.renderHandler=new Laya.Handler(this,this.updateItem),this.itemList.selectHandler=new Laya.Handler(this,this.onSelect),this.itemList.vScrollBarSkin=null,this.priceList.renderHandler=new Laya.Handler(this,this.updatePriceItem),this.priceList.selectHandler=new Laya.Handler(this,this.onPriceSelect),y.observableProperty.watch(I,this).key("diamond",e=>{this.diamondFont.value=e,console.log(C.table("config"));let t=C.table("config").get("withdrawal").value;this.proportion.text=` = ¥${(Number(t[2])/Number(t[1])*e).toString().match(/^\d+(?:\.\d{0,2})?/)}元`}),this.lockBtnBox.getChildByName("ad_unlock").disabled=!I.advertiseTimes,this.lockBtnBox.getChildByName("ad_unlock").active=Boolean(I.advertiseTimes)}onOpened(e){this.data=e,this.topBtnSelectIndex=(null==e?void 0:e.id)||0,this.priceDataList=C.table("config").get("withdrawal_times").value,this.updateTopBtnState(),this.canClick=!1,H.inst.send({api:"/friend/invite/list"}).then(e=>{this.canClick=!0,this.inviteNum=e.list.length}).catch(()=>{this.canClick=!0}),0==P.inst.getGuideStep()&&Laya.timer.once(300,this,()=>{y.eventGlobal.event("update_guid",{nodeList:[this.itemBuyBtn],call:()=>{},addPos:{x:100,y:120},step:0,text:"购买种子并种植",testAddPos:{x:-30,y:-60}})}),this.itemBuyBtn.on(Laya.Event.CLICK,this,this.plantBuy)}plantBuy(){var e,t;if(!this.canClick)return;if(this.getDataList()[this.itemListSelectIndex].base.seed_price.count>I.gold)return void y.view.openHint({text:"金币不足，去仓库出售蔬菜可以获得金币，偷菜获得的蔬菜也可以出售获得金币哦",call:()=>{}});let a=null===(t=null===(e=this.data)||void 0===e?void 0:e.parm)||void 0===t?void 0:t.landId;a||(a=P.inst.getEmptyLandId()),a?(this.canClick=!1,H.inst.send({api:"/land/sow",data:{landId:a,plantId:this.getDataList()[this.itemListSelectIndex].base.id,type:g.ApiTypeDefault}}).then(()=>{var e;p.inst.close(i.views.ShopView),(null===(e=this.data)||void 0===e?void 0:e.call)?this.data.call(this.getDataList()[this.itemListSelectIndex]):y.eventGlobal.event("plant_sow",[!0,this.getDataList()[this.itemListSelectIndex]])}).catch(()=>{this.canClick=!0})):y.view.openHint({text:"没有空的土地哦！",call:()=>{}})}onSelect(e){this.itemListSelectIndex=e}getDataList(){return 0==this.topBtnSelectIndex?D.list:2==this.topBtnSelectIndex?(ie.list.length||ie.init(),ie.list.sort((e,t)=>e.base.vitality-t.base.vitality)):void 0}updateItem(e,t){let a=this.getDataList()[t],s=e.getChildByName("hbox"),n=e.getChildByName("lock_icon");if(!a)return console.warn("数据丢失");if(a.lock)n.visible=!0,n.active=!0,s.visible=!1,s.active=!1;else{n.visible=!1,n.active=!1,s.visible=!0,s.active=!0;let e=0,t="";0==this.topBtnSelectIndex?(e=a.base.seed_price.count,t=a.base.seed_price.obj.icon):(e=a.base.cost.count,t=a.base.cost.obj.icon),s.getChildByName("num").value=e+"",s.getChildByName("gold_icon").skin=t}e.getChildByName("icon").skin=a.base.icon,e.getChildByName("name").text=a.base.name+(this.topBtnSelectIndex?"":"种子"),t==this.itemListSelectIndex?(e.skin=this.itemSelectBg[1],this.updateSelectDesc(),this.isFirst||y.audio.playSound(i.audios.button_click),this.isFirst=!1):e.skin=this.itemSelectBg[0]}updateSelectDesc(){var e,t,i;let a=this.getDataList()[this.itemListSelectIndex];if(2===this.topBtnSelectIndex){this.seedDesc.parent.visible=!1,this.feedDesc.text=a.base.desc.replace("&",a.base.vitality+""),this.feedDesc.visible=!0;let e=this.feedBuyBtn.getChildByName("box");return e.getChildByName("icon").skin=a.base.cost.obj.icon,void(e.getChildByName("value").value=a.base.cost.count+"")}let s=a.base;this.seedDesc.parent.visible=!0,this.feedDesc.visible=!1,this.seedDesc.text=s.desc,this.matureTime.text=k.formatSeconds(s.mature_time),this.itemBuyBtn.visible=!a.lock,P.inst.isOuter&&(this.itemBuyBtn.visible=!1),this.lockBtnBox.visible=a.lock,this.lockBtnBox.active=a.lock;let n=s.gain;for(let e=0;e<3;e++){let t=this.matureGainBox.getChildAt(e),i=null,a=0,o=n[e-1];0===e?(a=s.harvest,i=s.icon):o&&(i=o.obj.icon,a=o.count*s.harvest),t.getChildByName("icon").skin=i,t.getChildByName("count").text="x"+a}let o=this.lockBtnBox.getChildByName("unlock_buy").getChildByName("box");o.getChildByName("icon").skin=null===(t=null===(e=s.unlock_cost)||void 0===e?void 0:e.obj)||void 0===t?void 0:t.icon,o.getChildByName("value").value=(null===(i=s.unlock_cost)||void 0===i?void 0:i.count)+""}onClick(e){switch(e.target.name){case"close":p.inst.close(i.views.ShopView);break;case"seed":case"pet":case"feed":case"bank":y.audio.playSound(i.audios.button_click);let t=this.btnBoxTop.getChildIndex(e.target);this.topBtnSelectIndex!=t&&(this.topBtnSelectIndex=Number(t),this.updateTopBtnState());break;case"unlock_buy":case"ad_unlock":if(!this.canClick)return;if("unlock_buy"==e.target.name&&this.getDataList()[this.itemListSelectIndex].base.unlock_cost.count>I.gold)return void y.view.openHint({text:"金币不足，去仓库出售蔬菜可以获得金币，偷菜获得的蔬菜也可以出售获得金币哦",call:()=>{}});this.canClick=!1,H.inst.send({api:"/seeds/unlock",data:{plantId:this.getDataList()[this.itemListSelectIndex].base.id,type:"ad_unlock"==e.target.name?g.ApiTypeAD:g.ApiTypeDefault}}).then(t=>{D.list[this.itemListSelectIndex].lock=!1,this.itemList.changeItem(this.itemListSelectIndex,D.list[this.itemListSelectIndex]),this.canClick=!0,"ad_unlock"==e.target.name?y.eventGlobal.event("play_ad_get_reward",[e.target,t.adReward]):w.runAppFunction({uri:"eventCount",data:{type:"Freeunlock"}})}).catch(()=>{this.canClick=!0});break;case"left":this.selectPetIndex--,this.selectPetIndex<0&&(this.selectPetIndex=T.list.length-1),this.updatePet();break;case"right":this.selectPetIndex++,this.selectPetIndex>=T.list.length&&(this.selectPetIndex=0),this.updatePet();break;case"pet_btn":this.petBuy();break;case"go_watch":this.petGoWatch(T.list[this.selectPetIndex].base.id);break;case"go_rest":this.petGoWatch(1001);break;case"feed_buy":this.feedBuy();break;case"withdraw_btn":this.withdraw();break;case"record_btn":this.openWithdrawRecord();break;case"go_jump":this.priceGoJump(e.target)}}priceGoJump(e){1==e.dataSource?y.view.close(i.views.ShopView):2==e.dataSource&&(y.view.close(i.views.ShopView),H.inst.send({api:"/friend/invite/list",data:{}}).then(e=>{y.view.open(i.views.FriendsRewardView,{parm:{list:e.list,call:()=>{}}})}))}openWithdrawRecord(){this.canClick&&(this.canClick=!1,H.inst.send({api:"/withdraw/record",data:{}}).then(e=>{this.canClick=!0,y.view.open(i.views.WithdrawRecordView,{parm:e})}))}feedBuy(){let e=this.getDataList()[this.itemListSelectIndex];e&&this.canClick&&(I.warePetId?e.base.cost.count>I.gold?y.view.openHint({text:"金币不足，去仓库出售蔬菜可以获得金币，偷菜获得的蔬菜也可以出售获得金币哦",call:()=>{}}):(this.canClick=!1,H.inst.send({api:"/feed/buy",data:{feedId:e.base.id,type:g.ApiTypeDefault}}).then(()=>{this.canClick=!0,I.petVitality+=e.base.vitality,y.eventGlobal.event("play_get_reward",{node:this.feedBuyBtn,list:[{obj:e.base,count:1,posType:3}],notFly:!0})}).catch(()=>{this.canClick=!0})):y.view.openHint({text:"您还没有购买宠物哦！",call:()=>{}}))}petGoWatch(e){this.canClick&&(this.canClick=!1,H.inst.send({api:"/pet/wear",data:{petId:e,type:g.ApiTypeDefault}}).then(()=>{I.warePetId=e,this.canClick=!0,this.updatePet()}).catch(()=>{this.canClick=!0}))}petBuy(){let{base:e}=T.list[this.selectPetIndex];this.canClick&&(T.list[this.selectPetIndex].base.cost.count>I.gold?y.view.openHint({text:"金币不足，去仓库出售蔬菜可以获得金币，偷菜获得的蔬菜也可以出售获得金币哦",call:()=>{}}):(this.canClick=!1,H.inst.send({api:"/pet/buy",data:{petId:e.id,type:g.ApiTypeDefault}}).then(()=>{this.canClick=!0,T.list[this.selectPetIndex].lock=!1,this.updatePet(),I.warePetId||(I.warePetId=e.id),I.petVitality||(I.petVitality=e.vitality_max,I.digestCountDown=C.table("config").get("petDigestIntervalTime").value)}).catch(()=>{this.canClick=!0})))}updateTopBtnState(){for(let e=0;e<this.btnBoxTop.numChildren;e++){let t=this.btnBoxTop.getChildAt(e),i=t.getChildAt(0);e===this.topBtnSelectIndex?(t.skin="game/img-menuselected.png",i.skin=this.btnTopResList[e][1]):(t.skin="game/img-menunormal.png",i.skin=this.btnTopResList[e][0])}this.updateBottom()}updateBottom(){for(let e=0;e<this.bottomBox.numChildren;e++)this.updateCenterBoxState(e,!1);let e=this.itemBuyBtn.parent;switch(this.topBtnSelectIndex){case 0:this.isFirst=!0,this.updateCenterBoxState(0,!0),this.resetPetOrFeedList(),this.feedBuyBtn.visible=!1,e.visible=!0,e.active=!0;break;case 1:this.updateCenterBoxState(1,!0),this.updatePet();break;case 2:this.isFirst=!0,this.updateCenterBoxState(0,!0),this.resetPetOrFeedList(),this.feedBuyBtn.visible=!0,e.visible=!1,e.active=!1;break;case 3:this.updateCenterBoxState(2,!0),this.priceList.array=this.priceDataList}}updatePet(){T.list.length||T.init([]);let e=T.list[this.selectPetIndex];this.petIcon.source=`res/dog_${e.base.id}.atlas`,this.petName.text=e.base.name,this.petDesc.text=e.base.desc,this.vitalityMax.value=e.base.vitality_max+"";let t=this.petBuyBtn.getChildByName("btn_box");t.getChildByName("icon").skin=e.base.cost.obj.icon,t.getChildByName("value").value=e.base.cost.count+"";let i,a=this.bottomBox.getChildAt(1),s=a.getChildByName("find_box"),n=a.getChildByName("back_box");for(let t=0;t<5;t++)(i=s.getChildAt(t)).visible=20*t<e.base.sensitive,i.skin=20*t+10<e.base.sensitive?"game/img_star.png":"game/img_halfstar.png",(i=n.getChildAt(t)).visible=20*t<e.base.ability,i.skin=20*t+10<e.base.ability?"game/img_star.png":"game/img_halfstar.png";e.lock?(this.petBuyBtn.visible=!0,this.goRest.visible=!1,this.goWatch.visible=!1):(I.warePetId==e.base.id?(1===T.getUnlockLen()||1001===I.warePetId?this.goRest.disabled=!0:this.goRest.disabled=!1,this.goRest.visible=!0,this.goWatch.visible=!1):(this.goWatch.visible=!0,this.goRest.visible=!1),this.petBuyBtn.visible=!1)}resetPetOrFeedList(){this.itemListSelectIndex=0,this.itemList.selectedIndex=0,this.itemList.array=this.getDataList(),this.itemList.refresh()}updateCenterBoxState(e,t){this.bottomBox.getChildAt(e).visible=t,this.bottomBox.getChildAt(e).active=t}onPriceSelect(e){this.priceSelectIndex=e,this.updatePriceDesc()}updatePriceDesc(){let e=C.table("config").get("withdrawal_times").value[this.priceSelectIndex],t=this.conditionBox.getChildByName("desc"),i=this.conditionBox.getChildByName("bar_box"),a=this.conditionBox.getChildByName("go_jump");return this.conditionBox.visible=!1,I.orderLevel<e.orderLv?(this.conditionBox.visible=!0,this.descPriceBox.visible=!1,t.getChildByName("lb1").text="订单",t.getChildByName("lb2").text=`${e.orderLv}`,t.getChildByName("lb3").text="级即可提现",i.getChildByName("bar").width=434*(I.orderLevel>e.orderLv?1:I.orderLevel/e.orderLv),i.getChildByName("lb").text=`${I.orderLevel>e.orderLv?e.orderLv:I.orderLevel}/${e.orderLv}`,a.skin="game/img_goToWork.png",a.dataSource=1,void(this.canPrice=!1)):this.inviteNum<e.inviteAmount?(this.conditionBox.visible=!0,this.descPriceBox.visible=!1,t.getChildByName("lb1").text="邀请",t.getChildByName("lb2").text=`${e.inviteAmount}`,t.getChildByName("lb3").text="个好友即可提现",i.getChildByName("bar").width=434*(this.inviteNum>e.inviteAmount?1:this.inviteNum/e.inviteAmount),i.getChildByName("lb").text=`${this.inviteNum>e.inviteAmount?e.inviteAmount:this.inviteNum}/${e.inviteAmount}`,a.skin="game/img_goToInvite.png",a.dataSource=2,void(this.canPrice=!1)):(this.canPrice=!0,void(this.descPriceBox.visible=!0))}withdraw(){this.canPrice?null!=this.priceSelectIndex?this.canClick&&U.isBindWx&&(this.canClick=!1,H.inst.send({api:"/withdraw",data:{id:this.priceSelectIndex}}).then(e=>{this.canClick=!0,y.view.openHint({text:"提现成功",call:()=>{}}),I.withdraw=e.list,I.diamond=e.diamond,this.priceList.refresh(),w.runAppFunction({uri:"eventCount",data:{type:"Withdrawal"}})}).catch(()=>{this.canClick=!0})):y.view.openHint({text:"选择要提现的金额",call:()=>{}}):y.view.openHint({text:"提现条件不满足",call:()=>{}})}updatePriceItem(e,t){let i=this.priceDataList[t],a={id:0,times:0};const s=I.withdraw;for(let e=0;e<s.length;e++)if(s[e].id==t){a=s[e];break}if(e.getChildByName("value").text=i.price+"元",i.times){let t=i.times-a.times;e.getChildByName("times_box").visible=!0,t<=0&&(e.disabled=!0),e.getChildByName("times_box").visible=!1}else e.getChildByName("times_box").visible=!1;this.priceList.selectedIndex===t?e.getChildByName("bg").skin="game/img_priceselected.png":e.getChildByName("bg").skin="game/img_pricenormal.png"}}class se extends y.gameScript{onClick(e){switch(e.target.name){case"close":y.view.close(i.views.SignInDescView)}}}class ne extends l{onOpened(){this.signInList.array=C.table("signIn").list,this.signInList.vScrollBarSkin=null,this.signInList.renderHandler=new Laya.Handler(this,this.updateItem),this.updateProgress()}updateProgress(){let e=I.speedUpTimes/g.ADSpeedUpTimes;e>1&&(e=1),this.signInProgressBar.width=977*e,this.signInProgressLb.text=I.signInDays+"",this.progressDesc.text=`今日签到进度（使用${I.speedUpTimes}/${g.ADSpeedUpTimes}次加速）`,this.finishIcon.visible=I.speedUpTimes>=g.ADSpeedUpTimes}updateItem(e,t){const i=e.getChildByName("bar"),a=C.table("signIn").list[t];let s=I.signInDays/a.days;s>1&&(s=1),i.width=502*s;const n=e.getChildByName("reward_box");n.getChildByName("icon").skin=a.reward.obj.icon,n.getChildByName("amount").text=`x${a.reward.count}`,e.getChildByName("sign_days").text=`签到${a.days}天`;let o="",d=e.getChildByName("get_btn");d.dataSource=a.id,a.id>I.signInId?(d.active=!0,d.visible=!1,n.y=103,o="game/img_done.png",I.signInDays>=a.days&&(I.signInId?a.id-I.signInId==1&&(o="game/img_get.png",d.visible=!0,n.y=57):a.id==C.table("signIn").list[0].id&&(o="game/img_get.png",d.visible=!0,n.y=57))):(o="game/img_received.png",d.active=!1,d.visible=!0,n.y=57),d.skin=o}onClick(e){switch(e.target.name){case"close":p.inst.close(i.views.SignInView);break;case"desc_btn":y.view.open(i.views.SignInDescView);break;case"get_btn":const t=e.target.dataSource;H.inst.send({api:"/signIn/reward",data:{type:g.ApiTypeAD,signInId:t}}).then(()=>{I.signInId=t,this.signInList.refresh();let i=C.table("signIn").get(t).reward;y.eventGlobal.event("play_get_reward",{node:e.target,list:[{obj:i.obj,count:i.count,posType:i.obj.id==g.goldId?1:2}]})})}}}class oe extends y.gameScript{constructor(){super(...arguments),this.canClick=!0}onOpened(e){this.call=e.call;let t=C.table("config").get("all_speed_up_time").value;this.timeLb.text=`${Math.ceil(t/60)}分钟`,this.timesLb.text=`今日剩余${I.advertiseTimes}次`,I.advertiseTimes<=0&&(this.speedUpBtn.disabled=!0),Laya.timer.once(300,this,()=>{w.runAppFunction({uri:"ad",data:{adType:3}}),w.runAppFunction({uri:"ad",data:{adType:2}}),w.runAppFunction({uri:"eventCount",data:{type:"half_screen_advertisement"}}),w.runAppFunction({uri:"eventCount",data:{type:"bottom_advertisement"}})}),1==P.inst.getGuideStep()&&Laya.timer.once(300,this,()=>{y.eventGlobal.event("update_guid",{nodeList:[this.speedUpBtn],call:()=>{},addPos:{x:100,y:120}})}),this.speedUpBtn.on(Laya.Event.CLICK,this,()=>{this.canClick&&(this.canClick=!1,H.inst.send({api:"/land/speedUp",data:{type:g.ApiTypeAD}}).then(e=>{I.speedUpTimes=e.speedUpTimes,I.advertiseTimes=e.advertiseTimes,I.speedUpTimes==g.ADSpeedUpTimes&&(I.signInDays++,w.runAppFunction({uri:"eventCount",data:{type:"punchtheclock"}})),w.runAppFunction({uri:"eventCount",data:{type:"Advertisingacceleration"}}),y.view.close(i.views.SpeedUpView),y.eventGlobal.event("land_speed_up"),y.eventGlobal.event("play_ad_get_reward",[this.speedUpBtn,e.adReward]),this.call&&this.call(),1==P.inst.getGuideStep()&&(y.eventGlobal.event("update_guid_data",1),P.inst.guide())}))})}onClick(e){switch(e.target.name){case"close":y.view.close(i.views.SpeedUpView)}}onHdDestroy(){w.runAppFunction({uri:"closeAd",data:{}})}}class de extends l{constructor(){super(...arguments),this.taskList=null,this.canClick=!0}onOpened(){this.updateTaskList(),this.taskList.renderHandler=new Laya.Handler(this,this.itemRender),this.taskList.vScrollBarSkin=null}updateTaskList(){this.taskList.array=S.getList()}itemRender(e,t){let i=S.list[t].base;const a=S.getTask(null==i?void 0:i.id);if(!a)return void y.view.openHint({text:"任务配置出错,配置不存在",call:()=>{}});e.getChildByName("icon").skin=i.icon,e.getChildByName("title").text=i.title,e.getChildByName("desc").text=`${i.desc}(${((null==a?void 0:a.times)>i.times?i.times:null==a?void 0:a.times)||0}/${i.times})`;const s=e.getChildByName("reward");if(s.getChildByName("icon").skin=i.reward.obj.icon,1012===i.id){const e=C.table("config").get("Videorewards").value.count;let t=i.reward.count+(i.times-((null==a?void 0:a.times)||0))*e;t<i.reward.count&&(t=i.reward.count),s.getChildByName("amount").text="x"+t}else s.getChildByName("amount").text="x"+i.reward.count;const n=e.getChildByName("go_run"),o={id:i.id,ok:!1};(null==a?void 0:a.receive)?(n.skin="game/img_tomarow.png",n.active=!1,n.disabled=!0):(n.active=!0,n.disabled=!1,(null==a?void 0:a.times)>=i.times?(n.skin="game/img_get.png",o.ok=!0):n.skin="game/img_done.png"),n.dataSource=o}onClick(e){switch(e.target.name){case"close":p.inst.close(i.views.TaskView);break;case"go_run":if(!this.canClick)return;let t=e.target.dataSource;this.canClick=!1,t.ok?H.inst.send({api:"/task/reward",data:{type:g.ApiTypeDefault,taskId:t.id}}).then(()=>{const i=S.getTask(t.id);i.receive=1,t.ok=!1,this.canClick=!0,Laya.timer.frameOnce(1,this,()=>{this.updateTaskList(),this.taskList.refresh(),y.eventGlobal.event("update_task")}),y.eventGlobal.event("play_get_reward",{node:e.target,list:[{obj:i.base.reward.obj,count:i.base.reward.count,posType:i.base.reward.obj.id==g.diamondId?2:1}]})}):this.jump(t.id,e.target)}}jump(e,t){return __awaiter(this,void 0,void 0,function*(){let a;switch(e){case 1012:case 1001:if(null==(a=yield w.runAppFunction({uri:"ad",data:{},timestamp:Date.now()}))?void 0:a.code)return y.view.openHint({text:`广告播放失败[${a.code}]`,call:()=>{}}),void(this.canClick=!0);H.inst.send({api:"/ad",data:{taskId:1012==e?1012:null}}).then(i=>{y.eventGlobal.event("play_ad_get_reward",[t,i.adReward]),this.taskList.refresh(),S.taskAddTimes(1001),1012==e&&S.taskAddTimes(1012),this.canClick=!0,I.days>1&&H.inst.send({api:"/ad/record/not/click",data:{times:I.continuousAdTimes}})}),(null==a?void 0:a.data.hasClicked)?I.continuousAdTimes=0:I.continuousAdTimes++;break;case 1002:case 1003:y.view.close(i.views.TaskView);break;case 1004:y.view.close(i.views.TaskView),y.eventGlobal.event("open_friend");break;case 1005:case 1006:y.view.close(i.views.TaskView),y.view.open(i.views.ShopView,{parm:{id:1}});break;case 1007:y.view.close(i.views.TaskView),y.eventGlobal.event("plant_sow");break;case 1008:y.view.close(i.views.TaskView),y.view.open(i.views.WarehouseView);break;case 1009:y.view.close(i.views.TaskView),y.eventGlobal.event("open_friend");break;case 1010:y.view.close(i.views.TaskView),w.runAppFunction({uri:"wxShare",data:{},timestamp:Date.now()}).then(e=>{!e||(null==e?void 0:e.code)?y.view.openHint({text:e.data.message,call:()=>{}}):(y.view.openHint({text:e.data.message,call:()=>{}}),H.inst.send({api:"/friend/share"}).then(()=>{S.taskAddTimes(1010),w.runAppFunction({uri:"eventCount",data:{type:"share"}})}))});break;case 1011:y.view.close(i.views.TaskView),y.eventGlobal.event("plant_sow")}})}}let le=0;class re extends y.gameScript{constructor(){super(...arguments),this.itemList=null,this.itemName=null,this.itemDesc=null,this.itemIcon=null,this.itemSellCountLb=null,this.itemSellBox=null,this.itemSellGold=null,this.itemSellDiamond=null,this.sellBtn=null,this.sellAdBtn=null,this.empty_lb=null,this.dataList=[],this.selectItemIndex="0,0",this.selectItemSellCount=0,this.unitPriceGold=0,this.unitPriceDiamond=0,this.canClick=!0}onOpened(){y.audio.playSound(i.audios.dakaicangku),this.sellAdBtn.disabled=!I.advertiseTimes,this.sellAdBtn.active=Boolean(I.advertiseTimes),Laya.timer.once(300,this,()=>{w.runAppFunction({uri:"ad",data:{adType:3}})}),w.runAppFunction({uri:"eventCount",data:{type:"bottom_advertisement"}})}onHdAwake(){this.itemList.renderHandler=new Laya.Handler(this,this.renderItemList),this.itemList.vScrollBarSkin=null,this.updateList(),this.updateDesc(null),this.itemSellGold.removeSelf(),this.itemSellDiamond.removeSelf(),this.itemSellCountLb.on(Laya.Event.INPUT,this,()=>{this.selectItemSellCount=Number(this.itemSellCountLb.text),this.selectItemSellCount<1&&(this.selectItemSellCount=1,this.itemSellCountLb.text="1"),this.selectItemSellCount>this.selectItemData.count&&(this.selectItemSellCount=this.selectItemData.count),this.updateSelectSellCount()}),3==P.inst.getGuideStep()&&Laya.timer.once(300,this,()=>{y.eventGlobal.event("update_guid",{nodeList:[this.sellBtn],call:()=>{this.onClick({target:{name:"sellBtn"}}),Laya.timer.frameOnce(6,this,()=>{P.inst.guide(),y.view.close(i.views.WarehouseView)})},addPos:{x:100,y:120},step:3,text:"出售作物\n可获得金币或钻石",testAddPos:{x:0,y:-150}})})}updateList(){let e=0,t=0,i=!1;N.list.forEach(a=>{var s;this.dataList[t]||(this.dataList[t]=[]),this.dataList[t].push(a),a.base.id==(null===(s=this.selectItemData)||void 0===s?void 0:s.base.id)&&(i=!0),++e>2&&(e=0,t++)}),!i&&this.dataList.length&&(this.selectItemIndex="0,0",this.itemList.selectedIndex=0),this.itemList.array=this.dataList,this.empty_lb.visible=!this.dataList.length}renderItemList(e,t){let i=this.dataList[t];for(let a=0;a<3;a++){let s=e.getChildByName(`item_${a}`);if(i[a]){s.visible=!0,s.dataSource=`${t},${a}`;let e=s.getChildByName("icon");e.skin=i[a].base.icon,s.getChildByName("name").text=`${i[a].base.name}_${i[a].count}`,t==this.itemList.selectedIndex&&this.selectItemIndex==s.dataSource?(Laya.Tween.to(e,{y:0},150,null,null,null,!1),this.selectItemData=i[a],this.updateDesc(i[a])):56!=e.y&&Laya.Tween.to(e,{y:56},150)}else s.visible=!1}}onClick(e){switch(e.target.name){case"close":y.view.close(i.views.WarehouseView);break;case"item_0":case"item_1":case"item_2":this.selectItemIndex=e.target.dataSource,this.itemList.refresh();break;case"add":this.selectItemSellCount++,this.selectItemSellCount>this.selectItemData.count&&(this.selectItemSellCount=this.selectItemData.count),this.updateSelectSellCount();break;case"reduce":this.selectItemSellCount--,this.selectItemSellCount<1&&(this.selectItemSellCount=1),this.updateSelectSellCount();break;case"sellBtnAd":case"sellBtn":if(!this.canClick)return;{this.canClick=!1;let t=e.target.name,i=e.target;"sellBtn"==t&&(!le||le%10||(w.runAppFunction({uri:"ad",data:{adType:1}}),w.runAppFunction({uri:"eventCount",data:{type:"full_Screen"}})),le++),H.inst.send({api:"/warehouse/sell",data:{id:this.selectItemData.base.id,amount:this.selectItemSellCount,type:"sellBtn"==t?g.ApiTypeDefault:g.ApiTypeAD}}).then(e=>{this.sellAdBtn.disabled=!I.advertiseTimes,this.sellAdBtn.active=Boolean(I.advertiseTimes),this.canClick=!0,N.reduceAmount(this.selectItemData.base.id,this.selectItemSellCount),this.dataList=[],this.updateList(),this.itemList.refresh(),this.dataList.length||this.updateDesc(null);let a=[];this.unitPriceGold&&a.push({obj:C.table("currency").get(g.goldId),count:this.selectItemSellCount*this.unitPriceGold*("sellBtnAd"==t?2:1),posType:1}),this.unitPriceDiamond&&a.push({obj:C.table("currency").get(g.diamondId),count:this.selectItemSellCount*this.unitPriceDiamond*("sellBtnAd"==t?2:1),posType:2}),"sellBtnAd"==t&&(y.eventGlobal.event("play_ad_get_reward",[i,e.adReward]),w.runAppFunction({uri:"eventCount",data:{type:"Doublesale"}})),y.eventGlobal.event("play_get_reward",{node:this.sellBtn,list:a,callBack:()=>{}}),(I.adTimes>100||I.continuousAdTimes>20)&&(w.runAppFunction({uri:"ad",data:{adType:1}}),w.runAppFunction({uri:"ad",data:{adType:3}}),w.runAppFunction({uri:"eventCount",data:{type:"full_Screen"}}),w.runAppFunction({uri:"eventCount",data:{type:"bottom_advertisement"}}))}).catch(()=>{this.canClick=!0})}}}updateDesc(e){if(!e)return void(this.itemIcon.parent.visible=!1);let t,i;this.itemIcon.parent.visible=!0,this.itemSellDiamond.removeSelf(),this.itemSellGold.removeSelf(),this.itemIcon.skin=e.base.icon,this.itemName.text=e.base.name,this.itemDesc.text=e.base.desc;for(let a=0;a<e.base.gain.length;a++)e.base.gain[a].count&&(e.base.gain[a].obj.id==g.goldId?(t=e.base.gain[a],this.itemSellGold.getChildByName("icon").skin=e.base.gain[a].obj.icon,this.itemSellBox.addChild(this.itemSellGold)):(i=e.base.gain[a],this.itemSellDiamond.getChildByName("icon").skin=e.base.gain[a].obj.icon,this.itemSellBox.addChild(this.itemSellDiamond)));this.selectItemSellCount=e.count,this.unitPriceGold=(null==t?void 0:t.count)||0,this.unitPriceDiamond=(null==i?void 0:i.count)||0,this.updateSelectSellCount()}updateSelectSellCount(){this.itemSellCountLb.text=this.selectItemSellCount+"",this.itemSellGold.getChildByName("price").text=this.selectItemSellCount*this.unitPriceGold+"",this.itemSellDiamond.getChildByName("price").text=this.selectItemSellCount*this.unitPriceDiamond+""}onHdDestroy(){w.runAppFunction({uri:"closeAd",data:{}})}}class ce extends y.gameScript{onOpened(e){e.sort((e,t)=>t.time-e.time),this.dataList=e,this.list.array=e,this.list.renderHandler=new Laya.Handler(this,this.itemRender),this.list.vScrollBarSkin=null,this.owner.getChildByName("empty_lb").visible=!e.length}itemRender(e,t){const i=this.dataList[t];e.getChildByName("reward_box").getChildByName("amount").text=`-${i.diamond}`,e.getChildByName("time").text=`${new Date(i.time).toLocaleString("zh-CN",{hour12:!1})}`;const a=e.getChildByName("state_box").getChildByName("state");let s=C.table("config").get("withdrawal").value;e.getChildByName("state_box").getChildByName("price").text=`${(Number(s[2])/Number(s[1])*i.diamond).toString().match(/^\d+(?:\.\d{0,2})?/)}元`,a.text=`${i.state?"审核中":"已到账"}`,a.color=i.state?"#E93636":"#5A3F2A"}onClick(e){switch(e.target.name){case"close":y.view.close(i.views.WithdrawRecordView)}}}class he{constructor(){}static init(){var e=Laya.ClassUtils.regClass;e("view/AboutView.ts",b),e("components/Button.ts",_),e("components/ViewShowAni.ts",r),e("view/AddLandView.ts",F),e("view/BuyVitalityView.ts",E),e("view/FieldLevelUpView.ts",R),e("view/FriendsDescView.ts",M),e("view/FriendsRewardView.ts",$),e("view/FriendsView.ts",j),e("view/GatherDescView.ts",W),e("view/HintView.ts",J),e("view/LoginView.ts",X),e("view/MailDescView.ts",Y),e("view/MailView.ts",z),e("view/MainView.ts",P),e("components/FigureAni.ts",q),e("components/FieldComponent.ts",G),e("components/RedDotComponent.ts",K),e("components/GuideComponent.ts",Q),e("view/OrderView.ts",Z),e("view/OverView.ts",ee),e("view/SettingView.ts",te),e("view/ShopView.ts",ae),e("view/SignInDescView.ts",se),e("view/SignInView.ts",ne),e("view/SpeedUpView.ts",oe),e("view/TaskView.ts",de),e("view/WarehouseView.ts",re),e("view/WithdrawRecordView.ts",ce)}}he.width=1080,he.height=1920,he.scaleMode="fixedwidth",he.screenMode="none",he.alignV="middle",he.alignH="center",he.startScene="scenes/views/MainView.scene",he.sceneRoot="",he.debug=!1,he.stat=!1,he.physicsDebug=!1,he.exportSceneToJson=!0,he.init();class ue{constructor(){navigator.userAgent.indexOf("iPhone")>-1&&(Config.useWebGL2=!1),window.Laya3D?Laya3D.init(he.width,he.height):Laya.init(he.width,he.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=he.scaleMode,Laya.stage.screenMode=he.screenMode,Laya.stage.alignV=he.alignV,Laya.stage.alignH=he.alignH,Laya.URL.exportSceneToJson=he.exportSceneToJson,(he.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),he.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),he.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.stage.bgColor="#ffffff","debug"==BUILD_TYPE&&he.stat&&Laya.Stat.show(),Laya.ResourceVersion.enable("version-b6c3173893.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){return __awaiter(this,void 0,void 0,function*(){Config.customRenderID=[],f.init(),H.inst.init(g.baseUrl),y.eventGlobal.on("login_game",this,this.loginGame),Laya.SoundManager.useAudioMusic=!1,w.listenAppFunction(),yield new Promise(e=>{p.inst.open(i.views.LoginView,{showLoad:!1,parm:{call:t=>{this.initGameData(t),e(null)}},complete:e=>{Laya.timer.frameOnce(1,this,()=>{w.runAppFunction({uri:"closeImage",data:{}})})}})}),this.loginGame()})}loginGame(){Laya.loader.load(["scenes/views/MainView.scene","main_scene/img_landUpdate1.png"],Laya.Handler.create(this,()=>{console.log("ok"),y.audio.playMusic(i.audios.BGM,0),Laya.timer.frameOnce(1,this,()=>{Laya.View.hideLoadingPage(1e3),p.inst.open(he.startScene)})}),Laya.Handler.create(this,e=>{a.event("load_progress",e)},null,!1))}initGameData(e){}}ue.customRenderID=[],new ue}();